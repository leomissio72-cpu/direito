<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sistema Jurídico</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    :root{
      --bg:#f4f6fb;
      --sidebar:#0f1724;
      --card:#ffffff;
      --muted:#556179;
      --primary:#3366ff;
      --accent:#2b61ff;
      --success:#0ea44e;
      --warning:#f59e0b;
      --danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:'Inter',sans-serif;background:var(--bg);color:#0b1b2b}
    .app{display:flex;min-height:100vh}

/* SIDEBAR */
    .sidebar{
      width:220px;padding:20px;background:#0f1724;color:#fff;display:flex;flex-direction:column;gap:18px;
    }
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--primary),var(--accent));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
    .brand h3{margin:0;font-size:16px}
    nav{display:flex;flex-direction:column;gap:8px;margin-top:10px}
    .nav-btn{display:flex;align-items:center;gap:10px;padding:10px;border-radius:8px;border:none;background:transparent;color:rgba(255,255,255,0.9);cursor:pointer;font-weight:600}
    .nav-btn.active{background:rgba(255,255,255,0.06)}
    .sidebar-footer{margin-top:auto;color:var(--muted);font-size:13px}

/* WORKSPACE */
    .workspace{flex:1;display:flex;flex-direction:column;min-width:0}
    .topbar{height:68px;display:flex;align-items:center;justify-content:space-between;padding:0 20px;background:transparent;border-bottom:1px solid rgba(16,24,40,0.04)}
    .page-title{font-size:18px;font-weight:700;color:#0b1b2b}<br>    .user-area{display:flex;align-items:center;gap:12px}<br>    .avatar{width:40px;height:40px;border-radius:8px;background:linear-gradient(135deg,var(--primary),var(--accent));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}<br><br>    .main-area{padding:18px;overflow:auto}<br>    .container{background:var(--card);border-radius:12px;padding:18px;border:1px solid rgba(11,27,43,0.04);box-shadow:0 8px 24px rgba(11,27,43,0.04);margin-bottom:16px}<br>    h2{margin:0 0 8px 0;color:#0b1b2b}<br><br>    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}<br>    .col-full{grid-column:1/-1}<br>    label{display:block;margin-top:10px;color:var(--muted);font-weight:600}<br>    input,select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(11,27,43,0.06);background:#fff;color:#0b1b2b}<br>    textarea{min-height:100px;resize:vertical}<br>    .actions{display:flex;gap:10px;align-items:center;margin-top:14px}<br>    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:8px;border:none;cursor:pointer;font-weight:700}<br>    .btn.primary{background:linear-gradient(90deg,var(--primary),var(--accent));color:#fff}<br>    .btn.ghost{background:transparent;border:1px solid rgba(11,27,43,0.06);color:#0b1b2b}<br>    .btn.link{background:transparent;color:var(--muted);text-decoration:underline;padding:8px}<br><br>    table{width:100%;border-collapse:collapse;margin-top:12px;color:#0b1b2b}<br>    th,td{padding:10px;border-bottom:1px solid rgba(11,27,43,0.04);text-align:left;font-size:14px}<br>    th{color:var(--muted);font-weight:700}<br><br>    .no-data{color:var(--muted);padding:18px}<br>    .note-card{background:#fafbff;border-left:4px solid var(--primary);padding:12px;border-radius:8px;margin-bottom:10px}<br>    .note-meta{font-size:13px;color:var(--muted);margin-bottom:6px}<br>    .note-text{font-size:14px;color:#0b1b2b}<br><br>    .search-row{display:flex;gap:8px;align-items:center;margin-bottom:12px}<br>    @media (max-width:980px){.grid{grid-template-columns:1fr}.sidebar{width:64px}.brand h3{display:none}}<br>  </style><br></head><br><body><br>  <div class="app"><br>    <br>    <aside class="sidebar"><br>      <div class="brand"><br>        <div class="logo">J</div><br>        <div><br>          <h3>Sistema Jurídico</h3><br>          <div style="font-size:12px;color:var(--muted)">Escritório</div><br>        </div><br>      </div><br><br>      <nav><br>        <button class="nav-btn active" data-tab="cadastro"><span class="material-icons">person_add</span> <span class="label">Cadastro</span></button><br>        <button class="nav-btn" data-tab="lista"><span class="material-icons">folder_open</span> <span class="label">Processos</span></button><br>        <button class="nav-btn" data-tab="anotacoes"><span class="material-icons">note_add</span> <span class="label">Anotações</span></button><br>        <button class="nav-btn" data-tab="ferramentas"><span class="material-icons">build</span> <span class="label">Ferramentas</span></button><br>      </nav><br><br>      <div class="sidebar-footer"><br>        <div><strong>Planilha:</strong></div><br>        <div style="word-break:break-all;color:var(--muted);font-size:13px">docs.google.com/spreadsheets/d/1wU3D0kSBjAB_lIKKi1fUP9LZJK8pto2l7byvZBwucOM</div><br>      </div><br>    </aside><br><br>    <br>    <div class="workspace"><br>      <div class="topbar"><br>        <div class="page-title" id="pageTitle">Cadastro</div><br>        <div class="user-area"><br>          <div style="text-align:right"><br>            <div id="userName" style="font-weight:700">Usuário do Sistema</div><br>            <div style="font-size:12px;color:var(--muted)">Acesso Direto</div><br>          </div><br>          <div class="avatar">⚖️</div><br>        </div><br>      </div><br><br>      <main class="main-area"><br>        <br>        <section id="cadastro" class="container tab" style="display:block"><br>          <h2>Cadastro de Cliente & Processo</h2><br>          <form id="formCadastro" style="margin-top:12px"><br>            <div class="grid"><br>              <div><br>                <label>Nome completo</label><br>                <input name="Nome" type="text" required placeholder="Ex: José da Silva"><br><br>                <label>CPF</label><br>                <input name="CPF" type="text" placeholder="000.000.000-00"><br><br>                <label>RG</label><br>                <input name="RG" type="text" placeholder=""><br>              </div><br><br>              <div><br>                <label>Telefone / WhatsApp</label><br>                <input name="Telefone" type="text" placeholder="(11) 9xxxx-xxxx"><br><br>                <label>E-mail</label><br>                <input name="Email" type="email" placeholder="exemplo@dominio.com"><br><br>                <label>Responsável (advogado)</label><br>                <input name="Responsavel" type="text" placeholder="Adv. Fulano"><br>              </div><br><br>              <div class="col-full"><br>                <label>Endereço</label><br>                <input name="Endereço" type="text" placeholder="Rua, nº, bairro, cidade - UF"><br>              </div><br><br>              <div><br>                <label>Categoria do processo</label><br>                <select name="Categoria"><br>                  <option value="">Selecione...</option><br>                  <option value="Cível">Cível</option><br>                  <option value="Trabalhista">Trabalhista</option><br>                  <option value="Penal">Penal</option><br>                  <option value="Família">Família</option><br>                  <option value="Consumidor">Consumidor</option><br>                  <option value="Outros">Outros</option><br>                </select><br><br>                <label>Número do processo</label><br>                <input name="Número" type="text" placeholder="0001234-56.2025.8.26.0000"><br>              </div><br><br>              <div><br>                <label>Vara / Comarca</label><br>                <input name="Vara" type="text" placeholder="Ex: 3ª Vara Cível de São Paulo"><br><br>                <label>Parte Contrária</label><br>                <input name="Parte" type="text" placeholder="Nome da parte contrária"><br>              </div><br><br>              <div><br>                <label>Status</label><br>                <select name="Status"><br>                  <option value="Em andamento">Em andamento</option><br>                  <option value="Finalizado">Finalizado</option><br>                </select><br><br>                <label>Data de abertura</label><br>                <input name="DataAbertura" type="date"><br>              </div><br><br>              <div><br>                <label>Valor da causa (R$)</label><br>                <input name="Valor" type="number" step="0.01" placeholder="0.00"><br><br>                <label>Honorários (R$)</label><br>                <input name="Honorarios" type="number" step="0.01" placeholder="0.00"><br>              </div><br><br>              <div class="col-full"><br>                <label>Observações / Anotações</label><br>                <textarea name="Observações" placeholder="Anotações importantes, prazos, lembretes..."></textarea><br>              </div><br>            </div><br><br>            <div class="actions"><br>              <button class="btn primary" type="submit"><span class="material-icons">save</span> Salvar (Planilha)</button><br>              <button type="button" class="btn ghost" id="btnExportPdf"><span class="material-icons">picture_as_pdf</span> Exportar PDF</button><br>              <button type="button" class="btn link" id="btnOpenSheet">Abrir Planilha</button><br>            </div><br>          </form><br>        </section><br><br>        <br>        <section id="lista" class="container tab" style="display:none"><br>          <div style="display:flex;justify-content:space-between;align-items:center"><br>            <h2>Processos Registrados</h2><br>            <div style="display:flex;gap:8px;align-items:center"><br>              <input id="searchInput" placeholder="Pesquisar por nome, CPF, número ou categoria" style="padding:8px;border-radius:8px;border:1px solid rgba(11,27,43,0.06);min-width:240px"><br>              <div style="display:flex;gap:8px"><br>                <button class="btn ghost" id="btnRefresh">Atualizar</button><br>                <button class="btn ghost" id="btnDownloadCsv">Baixar CSV (filtrado)</button><br>                <button class="btn ghost" id="btnSortDate">Ordenar por Data ↓</button><br>              </div><br>            </div><br>          </div><br><br>          <div id="tableWrapper" style="margin-top:12px"><br>            <div class="no-data">Carregando registros...</div><br>          </div><br>        </section><br><br>        <br>        <section id="anotacoes" class="container tab" style="display:none"><br>          <h2>Anotações</h2><br><br>          <div style="display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px"><br>            <div style="flex:1;min-width:220px"><br>              <label>Processo (selecionar)</label><br>              <select id="selectProcesso" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(11,27,43,0.06);background:#fff;color:#0b1b2b"><br>                <option value="">--- selecione um processo ---</option><br>              </select><br>            </div><br><br>            <div style="flex:1;min-width:220px"><br>              <label>Adicionar anotação</label><br>              <input id="inputAnotacao" placeholder="Digite a anotação..." style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(11,27,43,0.06);background:#fff;color:#0b1b2b"><br>            </div><br><br>            <div style="display:flex;align-items:end"><br>              <button class="btn primary" id="btnSalvarAnotacao"><span class="material-icons">note_add</span> Salvar Anotação</button><br>            </div><br>          </div><br><br>          <div id="listaAnotacoes" style="margin-top:8px"><br>            <div class="no-data">Nenhuma anotação carregada.</div><br>          </div><br>        </section><br><br>        <br>        <section id="ferramentas" class="container tab" style="display:none"><br>          <h2>Ferramentas & Exportações</h2><br>          <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:12px"><br>            <button class="btn primary" id="btnExportAllPdf">Exportar todos (PDF)</button><br>            <button class="btn ghost" id="btnOpenSheet2">Abrir Planilha</button><br>          </div><br>          <div style="margin-top:16px;color:var(--muted)"><br>            Observações: se quiser que eu gere o Apps Script para gravar as anotações em uma aba separada (Anotacoes) com campos padronizados (Processo, Texto, DataCriacao, DataISO), eu já gero o código e você só cola no editor do Apps Script.<br>          </div><br>        </section><br>      </main><br>    </div><br>  </div><br><br><script><br>/* ===========================<br>   CONFIGURAÇÃO<br>   =========================== */<br>// seu Apps Script endpoint<br>const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrWzlAEW-f93fdVd4mCc-XaI6GlBQ_0luuDA-OV8oslGPfACLi69P7so9o4-YS3Lo2Cw/exec";<br>// planilha pública CSV<br>const SHEET_CSV = "https://docs.google.com/spreadsheets/d/1wU3D0kSBjAB_lIKKi1fUP9LZJK8pto2l7byvZBwucOM/export?format=csv&gid=0";<br><br>const navButtons = document.querySelectorAll('.nav-btn');<br>const tabs = document.querySelectorAll('.tab');<br>const pageTitle = document.getElementById('pageTitle');<br><br>navButtons.forEach(btn=>{<br>  btn.addEventListener('click', ()=>{<br>    navButtons.forEach(b=>b.classList.remove('active'));<br>    btn.classList.add('active');<br>    const tab = btn.dataset.tab;<br>    tabs.forEach(t=> t.style.display = (t.id===tab ? 'block' : 'none'));<br>    pageTitle.innerText = tab.charAt(0).toUpperCase() + tab.slice(1);<br>    if(tab==='lista') loadTable();<br>    if(tab==='anotacoes') loadAnotacoes();<br>  });<br>});<br><br>/* -----------------------------<br>   Utilities<br>   ----------------------------- */<br>function nowReadable() {<br>  const d = new Date();<br>  const pad = n => String(n).padStart(2,'0');<br>  return `${pad(d.getDate())}/${pad(d.getMonth()+1)}/${d.getFullYear()} ${pad(d.getHours())}:${pad(d.getMinutes())}`;<br>}<br>function parseCSV(text) {<br>  const rows = []; let cur=''; let row=[]; let inQuotes=false;<br>  for (let i=0;i<text.length;i++){<br>    const ch=text[i]; const next=text[i+1];<br>    if (ch === '"') {<br>      if (inQuotes && next === '"') { cur += '"'; i++; } else inQuotes = !inQuotes;<br>    } else if (ch === ',' && !inQuotes) {
      row.push(cur); cur='';
    } else if ((ch === '\n' || ch === '\r') && !inQuotes) {
      if (cur !== '' || row.length>0) { row.push(cur); rows.push(row); row=[]; cur=''; }
      if (ch === '\r' && next === '\n') i++;
    } else cur += ch;
  }
  if (cur !== '' || row.length>0) { row.push(cur); rows.push(row); }
  return rows.map(r=>r.map(c=>c.trim()));
}

/* -----------------------------
   SALVAR PROCESSO (envia para Apps Script)
   ----------------------------- */
const form = document.getElementById('formCadastro');
form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const fd = new FormData(form);
  const dataCriacao = nowReadable();
  fd.append('DataCriacao', dataCriacao);
  fd.append('DataISO', new Date().toISOString());
  fd.append('action','salvarProcesso'); // ajuste se precisar

  try {
    const res = await fetch(SCRIPT_URL, { method:'POST', body: fd });
    if (!res.ok) throw new Error('Resposta não OK');
    alert('Processo salvo na planilha!');
    form.reset();
    // update UI
    loadTable();
    populateProcessSelect();
  } catch (err) {
    console.error(err);
    alert('Erro ao salvar. Verifique Apps Script/CORS.');
  }
});

/* -----------------------------
   EXPORTAR PDF (abre novo tab)
   ----------------------------- */
document.getElementById('btnExportPdf').addEventListener('click', ()=>{
  const fd = new FormData(form);
  const obj = {};
  for(const [k,v] of fd.entries()) obj[k]=v;
  // generate pdf
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit:'pt', format:'a4' });
  let y = 40;
  doc.setFontSize(16); doc.setFont('Helvetica','bold'); doc.text('Ficha de Processo', 40, y); y += 26;
  doc.setFontSize(10); doc.setFont('Helvetica','normal'); doc.text('Gerado em: ' + nowReadable(), 40, y); y += 18;
  const add = (label,val)=>{
    doc.setFont('Helvetica','bold'); doc.text(label+':', 40, y);
    const lw = doc.getTextWidth(label+': ');
    doc.setFont('Helvetica','normal');
    const split = doc.splitTextToSize(String(val||'-'), 520 - lw);
    doc.text(split, 40+lw+6, y);
    y += split.length*12 + 8;
    if(y>750){ doc.addPage(); y=40; }
  };
  add('Nome', obj['Nome']); add('CPF', obj['CPF']); add('Categoria', obj['Categoria']); add('Número', obj['Número']);
  add('Vara', obj['Vara']); add('Status', obj['Status']); add('Valor', obj['Valor']); add('Observações', obj['Observações']);
  const blobUrl = doc.output('bloburl'); window.open(blobUrl, '_blank');
});

/* -----------------------------
   TABELA DE PROCESSOS (carrega CSV)
   ----------------------------- */
const tableWrapper = document.getElementById('tableWrapper');
const searchInput = document.getElementById('searchInput');
const btnRefresh = document.getElementById('btnRefresh');
const btnDownloadCsv = document.getElementById('btnDownloadCsv');
const btnSortDate = document.getElementById('btnSortDate');

let currentRows = []; let sortDesc = true;

btnRefresh.addEventListener('click', ()=>loadTable(searchInput.value.trim()));
searchInput && searchInput.addEventListener('input', ()=>loadTable(searchInput.value.trim()));

btnDownloadCsv.addEventListener('click', ()=>{
  if(!currentRows.length){ alert('Nenhum registro'); return; }
  const cols = Object.keys(currentRows[0]);
  const csv = [cols.join(',')].concat(currentRows.map(r=>cols.map(c=>`"${(r[c]||'').replace(/"/g,'""')}"`).join(','))).join('\r\n');
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'}); const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download = `processos_${new Date().toISOString().slice(0,10)}.csv`; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});

btnSortDate.addEventListener('click', ()=>{
  sortDesc = !sortDesc;
  btnSortDate.innerText = `Ordenar por Data ${sortDesc ? '↓' : '↑'}`;
  loadTable(searchInput.value.trim());
});

async function loadTable(filter='') {
  tableWrapper.innerHTML = '<div class="no-data">Carregando registros...</div>';
  try {
    const res = await fetch(SHEET_CSV);
    if(!res.ok) throw new Error('Erro CSV');
    const text = await res.text();
    const rows = parseCSV(text);
    if(rows.length < 2) { tableWrapper.innerHTML = '<div class="no-data">Planilha vazia.</div>'; return; }
    const headers = rows[0].map(h=>h.trim());
    const data = rows.slice(1).map(r=>{
      const obj = {}; headers.forEach((h,i)=>obj[h]=r[i]||''); 
      // try to enrich with date
      obj.__date = obj['DataISO'] ? new Date(obj['DataISO']) : (obj['DataCriacao'] ? parseReadableDate(obj['DataCriacao']) : null);
      return obj;
    });

    const f = filter.toLowerCase();
    let filtered = f ? data.filter(d=>
      (d['Nome'] && d['Nome'].toLowerCase().includes(f)) ||
      (d['CPF'] && d['CPF'].toLowerCase().includes(f)) ||
      (d['Número'] && d['Número'].toLowerCase().includes(f)) ||
      (d['Categoria'] && d['Categoria'].toLowerCase().includes(f))
    ) : data;

    filtered.sort((a,b)=>{
      const ta = a.__date ? a.__date.getTime():0; const tb = b.__date ? b.__date.getTime():0;
      return sortDesc ? tb - ta : ta - tb;
    });

    currentRows = filtered;

    if(!filtered.length){ tableWrapper.innerHTML = '<div class="no-data">Nenhum registro encontrado.</div>'; return; }
    // build table
    const table = document.createElement('table');
    const thead = document.createElement('thead'); const trh = document.createElement('tr');
    ['Criado em','Nome','Número','Categoria','Status','Vara','Valor','Observações'].forEach(c=>{ const th=document.createElement('th'); th.textContent=c; trh.appendChild(th); });
    thead.appendChild(trh); table.appendChild(thead);
    const tbody = document.createElement('tbody');
    filtered.forEach(item=>{
      const tr = document.createElement('tr');
      const tdDate = document.createElement('td'); tdDate.textContent = item['DataCriacao'] || (item.__date ? item.__date.toLocaleString() : '-'); tr.appendChild(tdDate);
      const tdNome = document.createElement('td'); tdNome.textContent = item['Nome'] || '-'; tr.appendChild(tdNome);
      const tdNum = document.createElement('td'); tdNum.textContent = item['Número'] || '-'; tr.appendChild(tdNum);
      const tdCat = document.createElement('td'); tdCat.textContent = item['Categoria'] || '-'; tr.appendChild(tdCat);
      const tdStatus = document.createElement('td'); tdStatus.textContent = item['Status'] || '-'; tr.appendChild(tdStatus);
      const tdVara = document.createElement('td'); tdVara.textContent = item['Vara'] || '-'; tr.appendChild(tdVara);
      const tdValor = document.createElement('td'); tdValor.textContent = item['Valor'] || '-'; tr.appendChild(tdValor);
      const tdObs = document.createElement('td'); tdObs.textContent = (item['Observações']||'').slice(0,120); tr.appendChild(tdObs);
      tbody.appendChild(tr);
    });
    table.appendChild(tbody); tableWrapper.innerHTML=''; tableWrapper.appendChild(table);
    // update process select for annotations
    populateProcessSelect(filtered);
  } catch (err) {
    console.error(err);
    tableWrapper.innerHTML = '<div class="no-data">Erro ao carregar registros. Verifique se a planilha está pública.</div>';
  }
}

function parseReadableDate(s) {
  // accepts dd/mm/yyyy hh:mm
  if(!s) return null;
  if(s.includes('/')) {
    const [d,t] = s.split(' ');
    const [dd,mm,yyyy] = d.split('/');
    const [hh,min] = (t||'00:00').split(':');
    return new Date(Number(yyyy),Number(mm)-1,Number(dd),Number(hh),Number(min));
  }
  const dt = new Date(s); return isNaN(dt.getTime())?null:dt;
}

/* -----------------------------
   ANOTAÇÕES: salvar e listar
   ----------------------------- */
const selectProcesso = document.getElementById('selectProcesso');
const inputAnotacao = document.getElementById('inputAnotacao');
const btnSalvarAnotacao = document.getElementById('btnSalvarAnotacao');
const listaAnotacoes = document.getElementById('listaAnotacoes');

btnSalvarAnotacao.addEventListener('click', async ()=>{
  const processo = selectProcesso.value;
  const texto = inputAnotacao.value && inputAnotacao.value.trim();
  if(!processo) return alert('Selecione um processo.');
  if(!texto) return alert('Digite a anotação.');
  const now = nowReadable();
  const fd = new FormData();
  fd.append('ProcessoNumero', processo);
  fd.append('Texto', texto);
  fd.append('DataCriacao', now);
  fd.append('DataISO', new Date().toISOString());
  fd.append('action','salvarAnotacao'); // ajuste se seu Apps Script usa outro action

  try {
    const res = await fetch(SCRIPT_URL, { method:'POST', body: fd });
    if(!res.ok) throw new Error('Resposta não-ok');
    alert('Anotação salva!');
    inputAnotacao.value = '';
    // optimistic: append to localStorage and reload list
    storeLocalAnnotation({ProcessoNumero:processo,Texto:texto,DataCriacao:now,DataISO:new Date().toISOString()});
    loadAnotacoes();
  } catch(err){
    console.error(err);
    // fallback: save locally
    storeLocalAnnotation({ProcessoNumero:processo,Texto:texto,DataCriacao:now,DataISO:new Date().toISOString()});
    alert('Falha ao salvar no servidor — anotação salva localmente.');
    loadAnotacoes();
  }
});

function storeLocalAnnotation(obj){
  try {
    const arr = JSON.parse(localStorage.getItem('anotacoes_local')||'[]');
    arr.push(obj);
    localStorage.setItem('anotacoes_local', JSON.stringify(arr));
  } catch(e){ console.error('localstore anot', e); }
}

async function loadAnotacoes(){
  listaAnotacoes.innerHTML = '<div class="no-data">Carregando anotações...</div>';
  // try to fetch via Apps Script
  try {
    const res = await fetch(`${SCRIPT_URL}?action=listarAnotacoes`);
    if(res.ok) {
      const json = await res.json().catch(()=>null);
      if(Array.isArray(json)) { renderAnotacoes(json); return; }
    }
