<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Jurídico - Dra. Advogada</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        /* Todos os estilos anteriores permanecem iguais */
        :root {
            --bg: #f4f6fb;
            --sidebar: #0f1724;
            --card: #ffffff;
            --muted: #556179;
            --primary: #3366ff;
            --accent: #2b61ff;
            --success: #0ea44e;
            --warning: #f59e0b;
            --danger: #ef4444;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: #0b1b2b;
            line-height: 1.6;
        }

        .app {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background: var(--sidebar);
            color: white;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 30px;
        }

        .logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .nav-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            width: 100%;
            text-align: left;
            border-radius: 8px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .nav-btn:hover, .nav-btn.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .topbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .container {
            background: var(--card);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }

        h1, h2, h3 {
            color: #0b1b2b;
            margin-bottom: 16px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--muted);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(51, 102, 255, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-ghost {
            background: transparent;
            border: 1px solid #ddd;
            color: var(--muted);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        /* Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #f8fafc;
            font-weight: 600;
            color: var(--muted);
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-aguardando { background: #fef3c7; color: #92400e; }
        .status-andamento { background: #dbeafe; color: #1e40af; }
        .status-finalizado { background: #d1fae5; color: #065f46; }

        /* Parcelas */
        .parcelas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .parcela-item {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }

        .parcela-item.paga {
            border-left: 4px solid var(--success);
        }

        .parcela-item.pendente {
            border-left: 4px solid var(--danger);
        }

        .parcela-btn {
            width: 100%;
            padding: 8px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 8px;
        }

        .parcela-btn.paga {
            background: var(--success);
            color: white;
        }

        .parcela-btn.pendente {
            background: var(--danger);
            color: white;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 24px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--muted);
        }

        /* Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary);
            margin: 8px 0;
        }

        .stat-label {
            color: var(--muted);
            font-weight: 600;
        }

        /* Tabs */
        .tab {
            display: none;
        }

        .tab.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Alert */
        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }

        /* Calculadora de Honorários */
        .calc-container {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid var(--primary);
        }

        .calc-result {
            margin-top: 16px;
            padding: 16px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .calc-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            margin: 8px 0;
        }

        /* Upload de Imagens */
        .upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .upload-area:hover {
            border-color: var(--primary);
            background: #f8fafc;
        }

        .imagens-lista {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .imagem-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .imagem-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }

        .imagem-info {
            padding: 8px;
            background: white;
        }

        .imagem-nome {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .imagem-meta {
            font-size: 10px;
            color: var(--muted);
        }

        .imagem-acoes {
            position: absolute;
            top: 4px;
            right: 4px;
        }

        /* Anotações */
        .anotacoes-lista {
            margin-top: 20px;
        }

        .anotacao-item {
            background: #f8fafc;
            border-left: 4px solid var(--primary);
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .anotacao-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 12px;
            color: var(--muted);
        }

        .anotacao-texto {
            font-size: 14px;
            line-height: 1.5;
        }

        .anotacao-acoes {
            margin-top: 8px;
            display: flex;
            gap: 8px;
        }

        /* Perfil do Cliente */
        .perfil-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e2e8f0;
        }

        .perfil-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            font-weight: bold;
        }

        .perfil-info {
            flex: 1;
        }

        .perfil-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .info-item {
            background: #f8fafc;
            padding: 16px;
            border-radius: 8px;
        }

        .info-label {
            font-size: 12px;
            color: var(--muted);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .info-value {
            font-size: 14px;
            color: #0b1b2b;
        }

        /* Contratos */
        .contrato-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 30px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: white;
        }

        .contrato-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .contrato-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .contrato-subtitle {
            font-size: 14px;
            color: #666;
        }

        .contrato-section {
            margin-bottom: 20px;
        }

        .contrato-section-title {
            font-weight: bold;
            margin-bottom: 10px;
            border-bottom: 1px solid #000;
        }

        .contrato-field {
            margin-bottom: 8px;
        }

        .contrato-label {
            font-weight: bold;
        }

        .contrato-signatures {
            display: flex;
            justify-content: space-between;
            margin-top: 50px;
        }

        .signature-line {
            margin-bottom: 40px;
        }

        .contrato-actions {
            margin-top: 20px;
            text-align: center;
        }

        /* Recibos */
        .recibo-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 30px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: white;
        }

        .recibo-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .recibo-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .recibo-detalhes {
            margin-bottom: 20px;
        }

        .recibo-valor {
            text-align: center;
            margin: 30px 0;
            font-size: 24px;
            font-weight: bold;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .app {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                padding: 16px;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
            
            .actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }

            .perfil-header {
                flex-direction: column;
                text-align: center;
            }

            .contrato-signatures {
                flex-direction: column;
                gap: 30px;
            }
        }

        /* Novos estilos para o perfil do cliente */
        .cliente-processos {
            margin-top: 20px;
            border-top: 1px solid #e2e8f0;
            padding-top: 20px;
        }

        .processos-lista {
            margin-top: 16px;
        }

        .processo-item {
            background: #f8fafc;
            border-left: 4px solid var(--primary);
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .processo-info h4 {
            margin-bottom: 8px;
            color: #0b1b2b;
        }

        .processo-meta {
            display: flex;
            gap: 16px;
            font-size: 14px;
            color: var(--muted);
        }

        .processo-acoes {
            display: flex;
            gap: 8px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .selecao-cliente {
            background: #f8fafc;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary);
        }

        .cliente-info {
            margin-top: 12px;
            padding: 12px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }

        .cliente-info p {
            margin-bottom: 8px;
            font-size: 14px;
        }

        /* Estilos para edição de dados do cliente */
        .editar-cliente-form {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary);
        }

        .dados-cliente-view {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary);
        }

        .dados-cliente-view .info-item {
            background: white;
            margin-bottom: 12px;
        }

        /* Estilos para processos externos */
        .processo-externo {
            border-left: 4px solid var(--warning);
        }

        .processo-externo .processo-meta {
            font-style: italic;
        }

        /* Estilos para dados do perfil na aba cadastro */
        .dados-perfil-cadastro {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid var(--success);
        }

        .perfil-mini-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin: 16px 0;
        }

        .perfil-mini-stat {
            background: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e2e8f0;
        }

        .perfil-mini-value {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary);
            margin: 4px 0;
        }

        .perfil-mini-label {
            font-size: 12px;
            color: var(--muted);
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="brand">
                <div class="logo">⚖️</div>
                <div>
                    <h3>Sistema Jurídico</h3>
                    <small>Dra. Advogada</small>
                </div>
            </div>

            <nav>
                <button class="nav-btn active" data-tab="dashboard">
                    <span class="material-icons">dashboard</span>
                    Dashboard
                </button>
                <button class="nav-btn" data-tab="cadastro">
                    <span class="material-icons">person_add</span>
                    Cadastro
                </button>
                <button class="nav-btn" data-tab="processos">
                    <span class="material-icons">folder_open</span>
                    Processos
                </button>
                <button class="nav-btn" data-tab="perfil">
                    <span class="material-icons">person</span>
                    Perfil
                </button>
                <button class="nav-btn" data-tab="parcelas">
                    <span class="material-icons">payments</span>
                    Parcelas
                </button>
                <button class="nav-btn" data-tab="contratos">
                    <span class="material-icons">description</span>
                    Contratos
                </button>
                <button class="nav-btn" data-tab="relatorios">
                    <span class="material-icons">assessment</span>
                    Relatórios
                </button>
            </nav>

            <div style="margin-top: auto; padding: 16px; text-align: center; color: rgba(255,255,255,0.6); font-size: 12px;">
                <div>Dra. Advogada</div>
                <div>OAB/SP 123.456</div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="topbar">
                <h1 id="page-title">Dashboard</h1>
                <div style="display: flex; align-items: center; gap: 12px;">
                    <span id="user-name">Dra. Advogada</span>
                    <div style="width: 40px; height: 40px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">DA</div>
                </div>
            </div>

            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total de Clientes</div>
                        <div class="stat-value" id="total-clientes">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total de Processos</div>
                        <div class="stat-value" id="total-processos">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Processos Ativos</div>
                        <div class="stat-value" id="processos-ativos">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Honorários Mensais</div>
                        <div class="stat-value" id="honorarios-mensais">R$ 0</div>
                    </div>
                </div>

                <div class="container">
                    <h2>Processos Recentes</h2>
                    <div id="processos-recentes">
                        <p style="text-align: center; color: var(--muted); padding: 40px;">
                            Nenhum processo cadastrado ainda.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Cadastro Tab -->
            <div id="cadastro" class="tab">
                <div class="container">
                    <h2>Cadastro de Processo</h2>
                    <div id="alert-cadastro"></div>
                    
                    <!-- Seção de Seleção de Cliente -->
                    <div class="selecao-cliente">
                        <h3>Seleção de Cliente</h3>
                        <div class="grid">
                            <div class="form-group">
                                <label for="selecionar-cliente">Buscar Cliente Existente</label>
                                <select id="selecionar-cliente">
                                    <option value="">Selecione um cliente...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="novo-cliente">Ou cadastrar novo cliente</label>
                                <button type="button" class="btn btn-ghost" id="btn-novo-cliente">
                                    <span class="material-icons">person_add</span>
                                    Novo Cliente
                                </button>
                            </div>
                        </div>
                        
                        <div id="info-cliente-selecionado" class="cliente-info" style="display: none;">
                            <h4>Cliente Selecionado</h4>
                            <div id="detalhes-cliente">
                                <!-- Detalhes do cliente serão preenchidos aqui -->
                            </div>
                            
                            <!-- Dados do Perfil na Aba de Cadastro -->
                            <div id="dados-perfil-cadastro" class="dados-perfil-cadastro" style="display: none;">
                                <h4>Resumo do Perfil</h4>
                                <div id="perfil-mini-stats" class="perfil-mini-stats">
                                    <!-- Estatísticas do perfil serão preenchidas aqui -->
                                </div>
                                <div id="processos-cliente">
                                    <!-- Lista de processos do cliente será preenchida aqui -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <form id="form-processo">
                        <div class="grid">
                            <div class="form-group">
                                <label for="cliente-nome">Nome do Cliente *</label>
                                <input type="text" id="cliente-nome" required>
                            </div>
                            <div class="form-group">
                                <label for="cliente-cpf">CPF</label>
                                <input type="text" id="cliente-cpf" placeholder="000.000.000-00">
                            </div>
                        </div>

                        <div class="grid">
                            <div class="form-group">
                                <label for="cliente-telefone">Telefone</label>
                                <input type="text" id="cliente-telefone" placeholder="(11) 99999-9999">
                            </div>
                            <div class="form-group">
                                <label for="cliente-email">E-mail</label>
                                <input type="email" id="cliente-email" placeholder="cliente@email.com">
                            </div>
                        </div>

                        <div class="grid">
                            <div class="form-group">
                                <label for="cliente-endereco">Endereço</label>
                                <input type="text" id="cliente-endereco" placeholder="Rua, número, bairro">
                            </div>
                            <div class="form-group">
                                <label for="cliente-profissao">Profissão</label>
                                <input type="text" id="cliente-profissao" placeholder="Profissão do cliente">
                            </div>
                        </div>

                        <div class="grid">
                            <div class="form-group">
                                <label for="processo-numero">Número do Processo</label>
                                <input type="text" id="processo-numero" placeholder="0000000-00.0000.0.00.0000">
                            </div>
                            <div class="form-group">
                                <label for="processo-categoria">Categoria</label>
                                <select id="processo-categoria">
                                    <option value="">Selecione...</option>
                                    <option value="Cível">Cível</option>
                                    <option value="Trabalhista">Trabalhista</option>
                                    <option value="Penal">Penal</option>
                                    <option value="Família">Família</option>
                                    <option value="Consumidor">Consumidor</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid">
                            <div class="form-group">
                                <label for="processo-vara">Vara/Comarca</label>
                                <input type="text" id="processo-vara">
                            </div>
                            <div class="form-group">
                                <label for="processo-status">Status</label>
                                <select id="processo-status">
                                    <option value="Aguardando Distribuição">Aguardando Distribuição</option>
                                    <option value="Em Andamento">Em Andamento</option>
                                    <option value="Aguardando Decisão">Aguardando Decisão</option>
                                    <option value="Finalizado">Finalizado</option>
                                </select>
                            </div>
                        </div>

                        <!-- Calculadora de Honorários -->
                        <div class="calc-container">
                            <h3 style="margin-top: 0; color: var(--primary);">Calculadora de Honorários</h3>
                            <div class="grid">
                                <div class="form-group">
                                    <label for="custos-fixos">Custos Fixos Mensais (R$)</label>
                                    <input type="number" id="custos-fixos" step="0.01" placeholder="5000.00" value="5000">
                                </div>
                                <div class="form-group">
                                    <label for="horas-trabalho">Horas Estimadas</label>
                                    <input type="number" id="horas-trabalho" placeholder="20" value="20">
                                </div>
                                <div class="form-group">
                                    <label for="valor-hora">Valor por Hora (R$)</label>
                                    <input type="number" id="valor-hora" step="0.01" placeholder="150.00" value="150">
                                </div>
                                <div class="form-group">
                                    <label for="percentual-lucro">Percentual de Lucro (%)</label>
                                    <input type="number" id="percentual-lucro" step="0.1" placeholder="30" value="30">
                                </div>
                            </div>
                            <div class="actions">
                                <button type="button" class="btn btn-primary" id="btn-calcular-honorarios">
                                    <span class="material-icons">calculate</span>
                                    Calcular Honorários Mínimos
                                </button>
                            </div>
                            <div id="resultado-calculo" class="calc-result" style="display: none;">
                                <div style="font-weight: bold; color: var(--primary);">Honorários Mínimos Recomendados:</div>
                                <div class="calc-value" id="valor-honorarios-minimos">R$ 0,00</div>
                                <div id="detalhes-calculo" style="font-size: 12px; color: var(--muted); margin-top: 8px;"></div>
                            </div>
                        </div>

                        <div class="grid">
                            <div class="form-group">
                                <label for="valor-causa">Valor da Causa (R$)</label>
                                <input type="number" id="valor-causa" step="0.01" placeholder="0.00">
                            </div>
                            <div class="form-group">
                                <label for="valor-honorarios">Honorários (R$)</label>
                                <input type="number" id="valor-honorarios" step="0.01" placeholder="0.00">
                            </div>
                        </div>

                        <div class="grid">
                            <div class="form-group">
                                <label for="forma-pagamento">Forma de Pagamento</label>
                                <select id="forma-pagamento">
                                    <option value="">Selecione...</option>
                                    <option value="À Vista">À Vista</option>
                                    <option value="Parcelado">Parcelado</option>
                                    <option value="Sucumbência">Sucumbência</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="quantidade-parcelas">Quantidade de Parcelas</label>
                                <input type="number" id="quantidade-parcelas" min="1" placeholder="Ex: 12" disabled>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="observacoes">Observações</label>
                            <textarea id="observacoes" rows="4"></textarea>
                        </div>

                        <div class="actions">
                            <button type="submit" class="btn btn-primary">
                                <span class="material-icons">save</span>
                                Salvar Processo
                            </button>
                            <button type="button" class="btn btn-ghost" id="btn-limpar">
                                <span class="material-icons">clear</span>
                                Limpar
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Processos Tab -->
            <div id="processos" class="tab">
                <div class="container">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>Processos Cadastrados</h2>
                        <div style="display: flex; gap: 12px;">
                            <input type="text" id="search-processos" placeholder="Pesquisar..." style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px;">
                            <button class="btn btn-ghost" id="btn-exportar">
                                <span class="material-icons">download</span>
                                Exportar
                            </button>
                        </div>
                    </div>

                    <div id="tabela-processos">
                        <p style="text-align: center; color: var(--muted); padding: 40px;">
                            Nenhum processo encontrado.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Perfil Tab - MODIFICADA -->
            <div id="perfil" class="tab">
                <div class="container">
                    <div style="margin-bottom: 20px;">
                        <label for="select-cliente-perfil">Selecionar Cliente</label>
                        <select id="select-cliente-perfil">
                            <option value="">Selecione um cliente...</option>
                        </select>
                    </div>

                    <div id="perfil-conteudo">
                        <p style="text-align: center; color: var(--muted); padding: 40px;">
                            Selecione um cliente para visualizar o perfil completo.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Parcelas Tab -->
            <div id="parcelas" class="tab">
                <div class="container">
                    <h2>Gerenciamento de Parcelas</h2>
                    
                    <div class="form-group">
                        <label for="select-processo-parcelas">Selecionar Processo</label>
                        <select id="select-processo-parcelas">
                            <option value="">Selecione um processo...</option>
                        </select>
                    </div>

                    <div id="parcelas-container">
                        <p style="text-align: center; color: var(--muted); padding: 40px;">
                            Selecione um processo para visualizar as parcelas.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Contratos Tab -->
            <div id="contratos" class="tab">
                <div class="container">
                    <h2>Contratos e Documentos</h2>
                    
                    <div class="form-group">
                        <label for="select-processo-contrato">Selecionar Processo</label>
                        <select id="select-processo-contrato">
                            <option value="">Selecione um processo...</option>
                        </select>
                    </div>

                    <div id="contratos-container">
                        <p style="text-align: center; color: var(--muted); padding: 40px;">
                            Selecione um processo para gerar contratos e recibos.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Relatórios Tab -->
            <div id="relatorios" class="tab">
                <div class="container">
                    <h2>Relatórios e Estatísticas</h2>
                    
                    <div class="grid">
                        <div class="form-group">
                            <label for="relatorio-tipo">Tipo de Relatório</label>
                            <select id="relatorio-tipo">
                                <option value="processos-por-status">Processos por Status</option>
                                <option value="honorarios-por-mes">Honorários por Mês</option>
                                <option value="parcelas-pendentes">Parcelas Pendentes</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="relatorio-periodo">Período</label>
                            <select id="relatorio-periodo">
                                <option value="30">Últimos 30 dias</option>
                                <option value="90">Últimos 90 dias</option>
                                <option value="365">Último ano</option>
                                <option value="tudo">Todo o período</option>
                            </select>
                        </div>
                    </div>

                    <div class="actions">
                        <button class="btn btn-primary" id="btn-gerar-relatorio">
                            <span class="material-icons">assessment</span>
                            Gerar Relatório
                        </button>
                        <button class="btn btn-success" id="btn-exportar-relatorio">
                            <span class="material-icons">download</span>
                            Exportar PDF
                        </button>
                    </div>

                    <div id="relatorio-conteudo" style="margin-top: 30px;">
                        <p style="text-align: center; color: var(--muted); padding: 40px;">
                            Gere um relatório para visualizar os dados.
                        </p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal para Detalhes do Processo -->
    <div id="modal-processo" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Detalhes do Processo</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div id="modal-processo-conteudo">
                <!-- Conteúdo será preenchido via JavaScript -->
            </div>
        </div>
    </div>

    <!-- Modal para Adicionar Anotação -->
    <div id="modal-anotacao" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Adicionar Anotação</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div>
                <div class="form-group">
                    <label for="anotacao-texto">Anotação</label>
                    <textarea id="anotacao-texto" rows="6" placeholder="Digite sua anotação aqui..."></textarea>
                </div>
                <div class="actions">
                    <button class="btn btn-primary" id="btn-salvar-anotacao">
                        <span class="material-icons">save</span>
                        Salvar Anotação
                    </button>
                    <button class="btn btn-ghost" onclick="fecharModal('modal-anotacao')">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Visualizar Contrato -->
    <div id="modal-contrato" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Contrato de Prestação de Serviços</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div id="modal-contrato-conteudo">
                <!-- Conteúdo será preenchido via JavaScript -->
            </div>
            <div class="actions" style="margin-top: 20px;">
                <button class="btn btn-primary" id="btn-imprimir-contrato">
                    <span class="material-icons">print</span>
                    Imprimir
                </button>
                <button class="btn btn-success" id="btn-download-contrato">
                    <span class="material-icons">download</span>
                    Baixar PDF
                </button>
                <button class="btn btn-ghost" onclick="fecharModal('modal-contrato')">
                    Fechar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para Visualizar Recibo -->
    <div id="modal-recibo" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Recibo de Pagamento</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div id="modal-recibo-conteudo">
                <!-- Conteúdo será preenchido via JavaScript -->
            </div>
            <div class="actions" style="margin-top: 20px;">
                <button class="btn btn-primary" id="btn-imprimir-recibo">
                    <span class="material-icons">print</span>
                    Imprimir
                </button>
                <button class="btn btn-success" id="btn-download-recibo">
                    <span class="material-icons">download</span>
                    Baixar PDF
                </button>
                <button class="btn btn-ghost" onclick="fecharModal('modal-recibo')">
                    Fechar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para Adicionar Processo Externo -->
    <div id="modal-processo-externo" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Adicionar Processo Externo</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div>
                <div class="form-group">
                    <label for="processo-externo-numero">Número do Processo</label>
                    <input type="text" id="processo-externo-numero" placeholder="0000000-00.0000.0.00.0000">
                </div>
                <div class="form-group">
                    <label for="processo-externo-categoria">Categoria</label>
                    <select id="processo-externo-categoria">
                        <option value="">Selecione...</option>
                        <option value="Cível">Cível</option>
                        <option value="Trabalhista">Trabalhista</option>
                        <option value="Penal">Penal</option>
                        <option value="Família">Família</option>
                        <option value="Consumidor">Consumidor</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="processo-externo-vara">Vara/Comarca</label>
                    <input type="text" id="processo-externo-vara">
                </div>
                <div class="form-group">
                    <label for="processo-externo-observacoes">Observações</label>
                    <textarea id="processo-externo-observacoes" rows="4" placeholder="Informações adicionais sobre o processo..."></textarea>
                </div>
                <div class="actions">
                    <button class="btn btn-primary" id="btn-salvar-processo-externo">
                        <span class="material-icons">save</span>
                        Salvar Processo Externo
                    </button>
                    <button class="btn btn-ghost" onclick="fecharModal('modal-processo-externo')">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sistema de Armazenamento - Adicionando chave para processos externos
        const STORAGE_KEYS = {
            CLIENTES: 'sistema_juridico_clientes',
            PROCESSOS: 'sistema_juridico_processos',
            PROCESSOS_EXTERNOS: 'sistema_juridico_processos_externos',
            PARCELAS: 'sistema_juridico_parcelas',
            IMAGENS: 'sistema_juridico_imagens',
            ANOTACOES: 'sistema_juridico_anotacoes',
            CONTRATOS: 'sistema_juridico_contratos'
        };

        // Funções de Armazenamento
        function salvarClientes(clientes) {
            localStorage.setItem(STORAGE_KEYS.CLIENTES, JSON.stringify(clientes));
        }

        function carregarClientes() {
            const data = localStorage.getItem(STORAGE_KEYS.CLIENTES);
            return data ? JSON.parse(data) : [];
        }

        function salvarProcessos(processos) {
            localStorage.setItem(STORAGE_KEYS.PROCESSOS, JSON.stringify(processos));
        }

        function carregarProcessos() {
            const data = localStorage.getItem(STORAGE_KEYS.PROCESSOS);
            return data ? JSON.parse(data) : [];
        }

        function salvarProcessosExternos(processosExternos) {
            localStorage.setItem(STORAGE_KEYS.PROCESSOS_EXTERNOS, JSON.stringify(processosExternos));
        }

        function carregarProcessosExternos() {
            const data = localStorage.getItem(STORAGE_KEYS.PROCESSOS_EXTERNOS);
            return data ? JSON.parse(data) : [];
        }

        function salvarParcelas(parcelas) {
            localStorage.setItem(STORAGE_KEYS.PARCELAS, JSON.stringify(parcelas));
        }

        function carregarParcelas() {
            const data = localStorage.getItem(STORAGE_KEYS.PARCELAS);
            return data ? JSON.parse(data) : [];
        }

        function salvarImagens(imagens) {
            localStorage.setItem(STORAGE_KEYS.IMAGENS, JSON.stringify(imagens));
        }

        function carregarImagens() {
            const data = localStorage.getItem(STORAGE_KEYS.IMAGENS);
            return data ? JSON.parse(data) : [];
        }

        function salvarAnotacoes(anotacoes) {
            localStorage.setItem(STORAGE_KEYS.ANOTACOES, JSON.stringify(anotacoes));
        }

        function carregarAnotacoes() {
            const data = localStorage.getItem(STORAGE_KEYS.ANOTACOES);
            return data ? JSON.parse(data) : [];
        }

        function salvarContratos(contratos) {
            localStorage.setItem(STORAGE_KEYS.CONTRATOS, JSON.stringify(contratos));
        }

        function carregarContratos() {
            const data = localStorage.getItem(STORAGE_KEYS.CONTRATOS);
            return data ? JSON.parse(data) : [];
        }

        // Função para agrupar clientes por nome e CPF
        function agruparClientesPorNomeCPF(clientes) {
            const grupos = {};
            
            clientes.forEach(cliente => {
                const chave = `${cliente.nome}-${cliente.cpf || 'sem-cpf'}`;
                
                if (!grupos[chave]) {
                    grupos[chave] = {
                        nome: cliente.nome,
                        cpf: cliente.cpf,
                        clientes: [],
                        processos: [],
                        processosExternos: []
                    };
                }
                
                grupos[chave].clientes.push(cliente);
            });
            
            return grupos;
        }

        // Sistema de Navegação - CORRIGIDO
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                // Remover classe active de todos os botões
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                // Adicionar classe active ao botão clicado
                this.classList.add('active');
                
                // Esconder todas as abas
                document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                // Mostrar aba correspondente
                const tabId = this.dataset.tab;
                document.getElementById(tabId).classList.add('active');
                
                // Atualizar título da página
                document.getElementById('page-title').textContent = this.textContent.trim();
                
                // Atualizar dados específicos da aba
                if (tabId === 'dashboard') {
                    atualizarDashboard();
                } else if (tabId === 'cadastro') {
                    atualizarSelectClientes();
                } else if (tabId === 'processos') {
                    carregarTabelaProcessos();
                } else if (tabId === 'perfil') {
                    atualizarSelectClientesPerfil();
                } else if (tabId === 'parcelas') {
                    atualizarSelectProcessosParcelas();
                } else if (tabId === 'contratos') {
                    atualizarSelectProcessosContratos();
                }
            });
        });

        // Função para atualizar o select de clientes na aba Perfil - MODIFICADA para agrupar
        function atualizarSelectClientesPerfil() {
            const clientes = carregarClientes();
            const grupos = agruparClientesPorNomeCPF(clientes);
            const select = document.getElementById('select-cliente-perfil');
            
            select.innerHTML = '<option value="">Selecione um cliente...</option>';
            
            Object.keys(grupos).forEach(chave => {
                const grupo = grupos[chave];
                const option = document.createElement('option');
                option.value = chave;
                option.textContent = `${grupo.nome} - ${grupo.cpf || 'CPF não informado'} (${grupo.clientes.length} cadastro(s))`;
                select.appendChild(option);
            });
        }

        // Evento para selecionar cliente na aba Perfil - MODIFICADO para agrupar
        document.getElementById('select-cliente-perfil').addEventListener('change', function() {
            const chave = this.value;
            const container = document.getElementById('perfil-conteudo');
            
            if (!chave) {
                container.innerHTML = '<p style="text-align: center; color: var(--muted); padding: 40px;">Selecione um cliente para visualizar o perfil completo.</p>';
                return;
            }
            
            const clientes = carregarClientes();
            const grupos = agruparClientesPorNomeCPF(clientes);
            const grupo = grupos[chave];
            
            if (!grupo) {
                container.innerHTML = '<p style="text-align: center; color: var(--muted); padding: 40px;">Grupo de cliente não encontrado.</p>';
                return;
            }
            
            // Carregar processos para todos os clientes do grupo
            const todosProcessos = carregarProcessos();
            const todosProcessosExternos = carregarProcessosExternos();
            
            grupo.processos = todosProcessos.filter(p => 
                grupo.clientes.some(c => c.id === p.clienteId)
            );
            
            grupo.processosExternos = todosProcessosExternos.filter(p => 
                grupo.clientes.some(c => c.id === p.clienteId)
            );
            
            // Exibir perfil completo do grupo de clientes
            container.innerHTML = `
                <div class="perfil-header">
                    <div class="perfil-avatar">${grupo.nome.charAt(0)}</div>
                    <div class="perfil-info">
                        <h2>${grupo.nome}</h2>
                        <p style="color: var(--muted);">CPF: ${grupo.cpf || 'Não informado'} | ${grupo.clientes.length} cadastro(s) no sistema</p>
                    </div>
                    <div class="actions">
                        <button class="btn btn-primary" id="btn-editar-grupo">
                            <span class="material-icons">edit</span>
                            Editar Dados do Grupo
                        </button>
                    </div>
                </div>

                <!-- Dados do Cliente - Modo Visualização -->
                <div class="dados-cliente-view" id="dados-cliente-view">
                    <h3>Dados Cadastrais Consolidados</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Nome Completo</div>
                            <div class="info-value">${grupo.nome}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">CPF</div>
                            <div class="info-value">${grupo.cpf || 'Não informado'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Telefones</div>
                            <div class="info-value">${[...new Set(grupo.clientes.map(c => c.telefone).filter(t => t))].join(', ') || 'Não informado'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">E-mails</div>
                            <div class="info-value">${[...new Set(grupo.clientes.map(c => c.email).filter(e => e))].join(', ') || 'Não informado'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Endereços</div>
                            <div class="info-value">${[...new Set(grupo.clientes.map(c => c.endereco).filter(e => e))].join('; ') || 'Não informado'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Profissões</div>
                            <div class="info-value">${[...new Set(grupo.clientes.map(c => c.profissao).filter(p => p))].join(', ') || 'Não informado'}</div>
                        </div>
                    </div>
                </div>

                <!-- Processos do Grupo -->
                <div class="cliente-processos">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3>Processos do Grupo (${grupo.processos.length + grupo.processosExternos.length})</h3>
                        <div class="actions">
                            <button class="btn btn-primary" onclick="abrirModalProcessoExternoGrupo('${chave}')">
                                <span class="material-icons">add</span>
                                Adicionar Processo Externo
                            </button>
                            <button class="btn btn-success" onclick="irParaCadastroComClienteGrupo('${chave}')">
                                <span class="material-icons">add_circle</span>
                                Novo Processo no Sistema
                            </button>
                        </div>
                    </div>

                    ${grupo.processos.length > 0 || grupo.processosExternos.length > 0 ? `
                        <div class="processos-lista">
                            ${grupo.processos.map(processo => `
                                <div class="processo-item">
                                    <div class="processo-info">
                                        <h4>${processo.numero || 'Número não informado'}</h4>
                                        <div class="processo-meta">
                                            <span>Categoria: ${processo.categoria || 'N/A'}</span>
                                            <span>Status: ${processo.status}</span>
                                            <span>Honorários: R$ ${(processo.honorarios || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</span>
                                        </div>
                                    </div>
                                    <div class="processo-acoes">
                                        <button class="btn btn-ghost btn-sm" onclick="verDetalhesProcesso('${processo.id}')">
                                            <span class="material-icons" style="font-size: 16px;">visibility</span>
                                        </button>
                                        <button class="btn btn-danger btn-sm" onclick="excluirProcesso('${processo.id}')">
                                            <span class="material-icons" style="font-size: 16px;">delete</span>
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                            
                            ${grupo.processosExternos.map(processo => `
                                <div class="processo-item processo-externo">
                                    <div class="processo-info">
                                        <h4>${processo.numero || 'Número não informado'} <span style="font-size: 12px; color: var(--warning);">(Externo)</span></h4>
                                        <div class="processo-meta">
                                            <span>Categoria: ${processo.categoria || 'N/A'}</span>
                                            <span>Vara: ${processo.vara || 'N/A'}</span>
                                            <span>Status: Processo Externo</span>
                                        </div>
                                        ${processo.observacoes ? `<div style="margin-top: 8px; font-size: 14px;">${processo.observacoes}</div>` : ''}
                                    </div>
                                    <div class="processo-acoes">
                                        <button class="btn btn-ghost btn-sm" onclick="editarProcessoExterno('${processo.id}')">
                                            <span class="material-icons" style="font-size: 16px;">edit</span>
                                        </button>
                                        <button class="btn btn-danger btn-sm" onclick="excluirProcessoExterno('${processo.id}')">
                                            <span class="material-icons" style="font-size: 16px;">delete</span>
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : `
                        <p style="text-align: center; color: var(--muted); padding: 40px;">
                            Nenhum processo encontrado para este grupo de clientes.
                        </p>
                    `}
                </div>

                <!-- Estatísticas do Grupo -->
                <div class="perfil-stats">
                    <div class="stat-card">
                        <div class="stat-label">Total de Processos</div>
                        <div class="stat-value">${grupo.processos.length + grupo.processosExternos.length}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Processos no Sistema</div>
                        <div class="stat-value">${grupo.processos.length}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Processos Externos</div>
                        <div class="stat-value">${grupo.processosExternos.length}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Valor Total em Honorários</div>
                        <div class="stat-value">R$ ${grupo.processos.reduce((total, p) => total + (p.honorarios || 0), 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</div>
                    </div>
                </div>
            `;
        });

        // Função para atualizar o select de clientes na aba Cadastro - MODIFICADA para mostrar dados do perfil
        function atualizarSelectClientes() {
            const clientes = carregarClientes();
            const select = document.getElementById('selecionar-cliente');
            
            select.innerHTML = '<option value="">Selecione um cliente...</option>';
            clientes.forEach(cliente => {
                const option = document.createElement('option');
                option.value = cliente.id;
                option.textContent = `${cliente.nome} - ${cliente.cpf || 'CPF não informado'}`;
                select.appendChild(option);
            });
        }

        // Evento para selecionar cliente na aba Cadastro - MODIFICADO para mostrar dados do perfil
        document.getElementById('selecionar-cliente').addEventListener('change', function() {
            const clienteId = this.value;
            const container = document.getElementById('info-cliente-selecionado');
            const detalhesCliente = document.getElementById('detalhes-cliente');
            const dadosPerfil = document.getElementById('dados-perfil-cadastro');
            
            if (!clienteId) {
                container.style.display = 'none';
                return;
            }

            const clientes = carregarClientes();
            const cliente = clientes.find(c => c.id === clienteId);
            
            if (!cliente) {
                container.style.display = 'none';
                return;
            }

            // Buscar todos os clientes com mesmo nome e CPF (grupo)
            const grupos = agruparClientesPorNomeCPF(clientes);
            const chave = `${cliente.nome}-${cliente.cpf || 'sem-cpf'}`;
            const grupo = grupos[chave];
            
            // Preencher detalhes básicos do cliente
            detalhesCliente.innerHTML = `
                <p><strong>Nome:</strong> ${cliente.nome}</p>
                <p><strong>CPF:</strong> ${cliente.cpf || 'Não informado'}</p>
                <p><strong>Telefone:</strong> ${cliente.telefone || 'Não informado'}</p>
                <p><strong>E-mail:</strong> ${cliente.email || 'Não informado'}</p>
            `;

            // Se existe grupo, mostrar dados do perfil
            if (grupo && grupo.clientes.length > 0) {
                const todosProcessos = carregarProcessos();
                const todosProcessosExternos = carregarProcessosExternos();
                
                const processosGrupo = todosProcessos.filter(p => 
                    grupo.clientes.some(c => c.id === p.clienteId)
                );
                
                const processosExternosGrupo = todosProcessosExternos.filter(p => 
                    grupo.clientes.some(c => c.id === p.clienteId)
                );
                
                dadosPerfil.innerHTML = `
                    <h4>Resumo do Perfil</h4>
                    <div class="perfil-mini-stats">
                        <div class="perfil-mini-stat">
                            <div class="perfil-mini-value">${grupo.clientes.length}</div>
                            <div class="perfil-mini-label">Cadastros</div>
                        </div>
                        <div class="perfil-mini-stat">
                            <div class="perfil-mini-value">${processosGrupo.length}</div>
                            <div class="perfil-mini-label">Processos</div>
                        </div>
                        <div class="perfil-mini-stat">
                            <div class="perfil-mini-value">${processosExternosGrupo.length}</div>
                            <div class="perfil-mini-label">Processos Ext.</div>
                        </div>
                        <div class="perfil-mini-stat">
                            <div class="perfil-mini-value">R$ ${processosGrupo.reduce((total, p) => total + (p.honorarios || 0), 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</div>
                            <div class="perfil-mini-label">Honorários</div>
                        </div>
                    </div>
                    ${processosGrupo.length > 0 ? `
                        <h5 style="margin-top: 16px;">Processos Recentes:</h5>
                        <div class="processos-lista">
                            ${processosGrupo.slice(0, 3).map(processo => `
                                <div class="processo-item" style="padding: 12px;">
                                    <div class="processo-info">
                                        <h5 style="margin: 0;">${processo.numero || 'Número não informado'}</h5>
                                        <div class="processo-meta">
                                            <span>${processo.categoria || 'N/A'}</span>
                                            <span>${processo.status}</span>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                `;
                dadosPerfil.style.display = 'block';
            } else {
                dadosPerfil.style.display = 'none';
            }

            container.style.display = 'block';
        });

        // Funções auxiliares para o agrupamento
        window.abrirModalProcessoExternoGrupo = function(chave) {
            // Implementação similar à função anterior, mas para grupo
            document.getElementById('modal-processo-externo').classList.add('active');
            document.getElementById('modal-processo-externo').dataset.grupoChave = chave;
        };

        window.irParaCadastroComClienteGrupo = function(chave) {
            const clientes = carregarClientes();
            const grupos = agruparClientesPorNomeCPF(clientes);
            const grupo = grupos[chave];
            
            if (grupo && grupo.clientes.length > 0) {
                // Usar o primeiro cliente do grupo
                const primeiroCliente = grupo.clientes[0];
                irParaCadastroComCliente(primeiroCliente.id);
            }
        };

        // As demais funções permanecem similares, mas adaptadas para o agrupamento
        // ...

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            atualizarDashboard();
            atualizarSelectClientes();
            atualizarSelectClientesPerfil();
            atualizarSelectProcessosParcelas();
            atualizarSelectProcessosContratos();
            
            // Adicionar dados de exemplo se não houver dados
            const clientes = carregarClientes();
            if (clientes.length === 0) {
                // Criar cliente de exemplo
                const clienteExemplo = {
                    id: 'exemplo-cliente-1',
                    nome: 'João Silva Santos',
                    cpf: '123.456.789-00',
                    telefone: '(11) 99999-9999',
                    email: 'joao.silva@email.com',
                    endereco: 'Rua das Flores, 123, Centro, São Paulo - SP',
                    profissao: 'Engenheiro',
                    dataCadastro: new Date().toISOString()
                };
                
                clientes.push(clienteExemplo);
                salvarClientes(clientes);
                
                // Criar processo de exemplo
                const processos = carregarProcessos();
                const processoExemplo = {
                    id: 'exemplo-1',
                    clienteId: 'exemplo-cliente-1',
                    numero: '0001234-56.2024.8.26.0001',
                    categoria: 'Cível',
                    vara: '3ª Vara Cível de São Paulo',
                    status: 'Em Andamento',
                    valorCausa: 50000,
                    honorarios: 5000,
                    formaPagamento: 'Parcelado',
                    parcelas: 10,
                    observacoes: 'Processo sobre indenização por danos morais.',
                    dataCadastro: new Date().toISOString(),
                    parcelasPagas: 3
                };
                
                processos.push(processoExemplo);
                salvarProcessos(processos);
                
                // Criar processo externo de exemplo
                const processosExternos = carregarProcessosExternos();
                const processoExternoExemplo = {
                    id: 'exemplo-externo-1',
                    clienteId: 'exemplo-cliente-1',
                    numero: '2023.001.123456-7',
                    categoria: 'Trabalhista',
                    vara: '2ª Vara do Trabalho de São Paulo',
                    observacoes: 'Processo trabalhista por rescisão indireta. Cliente foi representado por outro advogado anteriormente.',
                    dataCadastro: new Date().toISOString()
                };
                
                processosExternos.push(processoExternoExemplo);
                salvarProcessosExternos(processosExternos);
                
                atualizarDashboard();
                atualizarSelectClientes();
                atualizarSelectClientesPerfil();
            }
        });

        // As demais funções do sistema (calculadora, formulários, etc.) permanecem
        // ...

    </script>
</body>
</html>
