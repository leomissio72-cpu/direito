<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema Jurídico - Dra. Advogada</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    /* Estilos existentes mantidos */
    :root{
      --bg:#f4f6fb;
      --sidebar:#0f1724;
      --card:#ffffff;
      --muted:#556179;
      --primary:#3366ff;
      --accent:#2b61ff;
      --success:#0ea44e;
      --warning:#f59e0b;
      --danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:'Inter',sans-serif;
      background:var(--bg);
      color:#0b1b2b;
      background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23f4f6fb"/><path d="M30,30 L40,20 L60,40 L70,30 L80,40 L60,60 L40,40 Z" fill="%233366ff" opacity="0.03"/><circle cx="20" cy="80" r="8" fill="%232b61ff" opacity="0.03"/><rect x="80" y="70" width="15" height="15" fill="%230ea44e" opacity="0.03" transform="rotate(45 87.5 77.5)"/></svg>');
      background-size: 200px 200px;
    }
    .app{display:flex;min-height:100vh}

    /* SIDEBAR */
    .sidebar{
      width:220px;
      padding:20px;
      background:#0f1724;
      color:#fff;
      display:flex;
      flex-direction:column;
      gap:18px;
      background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%230f1724"/><path d="M30,20 L50,10 L70,20 L70,40 L50,50 L30,40 Z" fill="%233366ff" opacity="0.05"/><path d="M20,60 L40,50 L60,60 L60,80 L40,90 L20,80 Z" fill="%232b61ff" opacity="0.03"/></svg>');
      background-size: 150px 150px;
    }
    .brand{display:flex;align-items:center;gap:12px}
    .logo{
      width:44px;
      height:44px;
      border-radius:10px;
      background:linear-gradient(135deg,var(--primary),var(--accent));
      display:flex;
      align-items:center;
      justify-content:center;
      color:#fff;
      font-weight:700;
      position: relative;
      overflow: hidden;
    }
    .logo::after {
      content: "⚖️";
      position: absolute;
      font-size: 20px;
    }
    .brand h3{margin:0;font-size:16px}
    .brand .advogada-nome {
      font-size: 12px;
      color: var(--muted);
      margin-top: 2px;
    }
    nav{display:flex;flex-direction:column;gap:8px;margin-top:10px}
    .nav-btn{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px;
      border-radius:8px;
      border:none;
      background:transparent;
      color:rgba(255,255,255,0.9);
      cursor:pointer;
      font-weight:600;
      text-align:left;
      width:100%;
      transition: all 0.3s ease;
    }
    .nav-btn:hover{
      background:rgba(255,255,255,0.08);
      transform: translateX(5px);
    }
    .nav-btn.active{
      background:rgba(255,255,255,0.12);
      color:#fff;
      box-shadow: 0 2px 8px rgba(51, 102, 255, 0.3);
    }
    .sidebar-footer{
      margin-top:auto;
      color:var(--muted);
      font-size:13px;
      text-align: center;
      padding: 12px;
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
    }

    /* WORKSPACE */
    .workspace{flex:1;display:flex;flex-direction:column;min-width:0}
    .topbar{
      height:68px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 20px;
      background:transparent;
      border-bottom:1px solid rgba(16,24,40,0.04);
    }
    .page-title{
      font-size:18px;
      font-weight:700;
      color:#0b1b2b;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .user-area{display:flex;align-items:center;gap:12px}
    .avatar{
      width:40px;
      height:40px;
      border-radius:8px;
      background:linear-gradient(135deg,var(--primary),var(--accent));
      display:flex;
      align-items:center;
      justify-content:center;
      color:#fff;
      font-weight:700;
    }

    .main-area{padding:18px;overflow:auto}
    .container{
      background:var(--card);
      border-radius:12px;
      padding:18px;
      border:1px solid rgba(11,27,43,0.04);
      box-shadow:0 8px 24px rgba(11,27,43,0.04);
      margin-bottom:16px;
      position: relative;
    }
    h2{
      margin:0 0 8px 0;
      color:#0b1b2b;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .col-full{grid-column:1/-1}
    label{
      display:block;
      margin-top:10px;
      color:var(--muted);
      font-weight:600;
      font-size:13px;
    }
    input,select,textarea{
      width:100%;
      padding:10px;
      border-radius:8px;
      border:1px solid rgba(11,27,43,0.06);
      background:#fff;
      color:#0b1b2b;
      font-family:'Inter',sans-serif;
      font-size:14px;
      transition: all 0.3s ease;
    }
    input:focus,select:focus,textarea:focus{
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(51, 102, 255, 0.1);
    }
    textarea{min-height:100px;resize:vertical}
    .actions{
      display:flex;
      gap:10px;
      align-items:center;
      margin-top:14px;
      flex-wrap:wrap;
    }
    .btn{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 14px;
      border-radius:8px;
      border:none;
      cursor:pointer;
      font-weight:700;
      font-size:14px;
      transition:all 0.3s ease;
      text-decoration: none;
    }
    .btn:hover{
      opacity:0.9;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .btn.primary{
      background:linear-gradient(90deg,var(--primary),var(--accent));
      color:#fff;
    }
    .btn.ghost{
      background:transparent;
      border:1px solid rgba(11,27,43,0.06);
      color:#0b1b2b;
    }
    .btn.link{
      background:transparent;
      color:var(--muted);
      text-decoration:underline;
      padding:8px;
    }
    .btn.danger{
      background:var(--danger);
      color:#fff;
    }
    .btn.success{
      background:var(--success);
      color:#fff;
    }

    table{
      width:100%;
      border-collapse:collapse;
      margin-top:12px;
      color:#0b1b2b;
    }
    th,td{
      padding:10px;
      border-bottom:1px solid rgba(11,27,43,0.04);
      text-align:left;
      font-size:14px;
    }
    th{
      color:var(--muted);
      font-weight:700;
      background: rgba(51, 102, 255, 0.03);
    }
    td .btn{padding:6px 10px;font-size:13px}
    td select{
      padding:6px 8px;
      font-size:13px;
      border:1px solid rgba(11,27,43,0.1);
      border-radius: 6px;
    }

    .no-data{
      color:var(--muted);
      padding:18px;
      text-align:center;
    }
    .note-card{
      background:#fafbff;
      border-left:4px solid var(--primary);
      padding:12px;
      border-radius:8px;
      margin-bottom:10px;
      transition: all 0.3s ease;
    }
    .note-card:hover {
      transform: translateX(5px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .note-meta{
      font-size:13px;
      color:var(--muted);
      margin-bottom:6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .note-text{
      font-size:14px;
      color:#0b1b2b;
    }

    .alert{
      padding:12px 16px;
      border-radius:8px;
      margin-bottom:12px;
      font-size:14px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .alert.success{
      background:#d1fae5;
      color:#065f46;
      border:1px solid #10b981;
    }
    .alert.error{
      background:#fee2e2;
      color:#991b1b;
      border:1px solid #ef4444;
    }

    .status-badge{
      display:inline-block;
      padding:4px 8px;
      border-radius:6px;
      font-size:12px;
      font-weight:600;
    }
    .status-aguardando{background:#fef3c7;color:#92400e}
    .status-andamento{background:#dbeafe;color:#1e40af}
    .status-suspenso{background:#fed7aa;color:#9a3412}
    .status-sentenca{background:#e9d5ff;color:#6b21a8}
    .status-recurso{background:#fce7f3;color:#9f1239}
    .status-arquivado{background:#e5e7eb;color:#374151}
    .status-finalizado{background:#d1fae5;color:#065f46}

    /* Estilos para Contratos */
    .contrato-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      background: white;
    }
    .contrato-header {
      text-align: center;
      margin-bottom: 30px;
    }
    .contrato-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .contrato-subtitle {
      font-size: 14px;
      color: #666;
    }
    .contrato-section {
      margin-bottom: 20px;
    }
    .contrato-section-title {
      font-weight: bold;
      margin-bottom: 10px;
      border-bottom: 1px solid #000;
    }
    .contrato-field {
      margin-bottom: 8px;
    }
    .contrato-label {
      font-weight: bold;
    }
    .contrato-signatures {
      display: flex;
      justify-content: space-between;
      margin-top: 50px;
    }
    .signature-line {
      margin-bottom: 40px;
    }
    .contrato-actions {
      margin-top: 20px;
      text-align: center;
    }
    
    /* Estilos para filtros */
    .filtros-container {
      background: #f8fafc;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 16px;
    }
    .filtros-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin-bottom: 12px;
    }
    .filtro-acoes {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    /* Estilos para calculadoras */
    .calc-container {
      background: #f8fafc;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 16px;
    }
    .calc-result {
      margin-top: 16px;
      padding: 12px;
      background: white;
      border-radius: 8px;
      border-left: 4px solid var(--primary);
      display: none;
    }
    .calc-result.show {
      display: block;
    }
    .calc-title {
      font-weight: bold;
      margin-bottom: 4px;
    }
    .calc-value {
      font-size: 18px;
      font-weight: bold;
      color: var(--primary);
    }
    
    /* Estilos para interações */
    .interacao-card {
      background: #fafbff;
      border-left: 4px solid var(--primary);
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 10px;
    }
    .interacao-meta {
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .interacao-tipo {
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: bold;
    }
    .tipo-reuniao { background: #dbeafe; color: #1e40af; }
    .tipo-telefonema { background: #fef3c7; color: #92400e; }
    .tipo-email { background: #d1fae5; color: #065f46; }
    .tipo-anotacao { background: #e9d5ff; color: #6b21a8; }
    
    /* Estilos para gráficos */
    .charts-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 16px;
      margin-top: 20px;
    }
    .chart-card {
      background: var(--card);
      border-radius: 12px;
      padding: 18px;
      border: 1px solid rgba(11,27,43,0.04);
      box-shadow: 0 8px 24px rgba(11,27,43,0.04);
    }
    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    .chart-title {
      font-size: 16px;
      font-weight: 600;
      color: #0b1b2b;
    }
    .chart-actions {
      display: flex;
      gap: 8px;
    }
    .chart-wrapper {
      position: relative;
      height: 300px;
    }

    @media (max-width:980px){
      .grid{grid-template-columns:1fr}
      .sidebar{width:64px}
      .brand h3,.brand .advogada-nome,.sidebar-footer{display:none}
      .nav-btn .label{display:none}
      .charts-container {
        grid-template-columns: 1fr;
      }
      .chart-card {
        min-width: 0;
      }
    }

    .tab {
      display: none;
      animation: fadeIn 0.5s ease-in;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }
    .stat-card {
      background: var(--card);
      border-radius: 12px;
      padding: 18px;
      border: 1px solid rgba(11,27,43,0.04);
      box-shadow: 0 2px 8px rgba(11,27,43,0.04);
      text-align: center;
    }
    .stat-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--primary);
      margin: 8px 0;
    }
    .stat-label {
      font-size: 13px;
      color: var(--muted);
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h3>Sistema Jurídico</h3>
          <div class="advogada-nome">Dra. Advogada</div>
        </div>
      </div>

      <nav>
        <button class="nav-btn active" data-tab="dashboard">
          <span class="material-icons">dashboard</span>
          <span class="label">Dashboard</span>
        </button>
        <button class="nav-btn" data-tab="cadastro">
          <span class="material-icons">person_add</span>
          <span class="label">Cadastro</span>
        </button>
        <button class="nav-btn" data-tab="lista">
          <span class="material-icons">folder_open</span>
          <span class="label">Processos</span>
        </button>
        <button class="nav-btn" data-tab="perfil">
          <span class="material-icons">person</span>
          <span class="label">Perfil</span>
        </button>
        <button class="nav-btn" data-tab="contratos">
          <span class="material-icons">description</span>
          <span class="label">Contratos</span>
        </button>
        <button class="nav-btn" data-tab="contratos-criados">
          <span class="material-icons">folder_open</span>
          <span class="label">Contratos Criados</span>
        </button>
        <button class="nav-btn" data-tab="anotacoes">
          <span class="material-icons">note_add</span>
          <span class="label">Anotações</span>
        </button>
        <button class="nav-btn" data-tab="interacao">
          <span class="material-icons">people</span>
          <span class="label">Interação</span>
        </button>
        <button class="nav-btn" data-tab="ferramentas">
          <span class="material-icons">build</span>
          <span class="label">Ferramentas</span>
        </button>
      </nav>

      <div class="sidebar-footer">
        <div style="font-size:12px;margin-top:8px">
          <strong>Dra. Advogada</strong>
        </div>
        <div style="font-size:11px;color:rgba(255,255,255,0.5);margin-top:4px">
          OAB/SP 123.456
        </div>
      </div>
    </aside>

    <!-- WORKSPACE -->
    <div class="workspace">
      <div class="topbar">
        <div class="page-title" id="pageTitle">
          <span class="material-icons">dashboard</span>
          Dashboard
        </div>
        <div class="user-area">
          <div style="text-align:right">
            <div id="userName" style="font-weight:700">Dra. Advogada</div>
            <div style="font-size:12px;color:var(--muted)">OAB/SP 123.456</div>
          </div>
          <div class="avatar">⚖️</div>
        </div>
      </div>

      <main class="main-area">
        <!-- DASHBOARD -->
        <section id="dashboard" class="container tab" style="display:block">
          <h2><span class="material-icons">dashboard</span>Dashboard do Escritório</h2>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-label">Total de Processos</div>
              <div class="stat-value" id="totalProcessos">0</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Processos Ativos</div>
              <div class="stat-value" id="processosAtivos">0</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Honorários Mensais</div>
              <div class="stat-value" id="honorariosMensais">R$ 0</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Clientes Ativos</div>
              <div class="stat-value" id="clientesAtivos">0</div>
            </div>
          </div>
          
          <!-- Gráficos Interativos -->
          <div class="charts-container">
            <div class="chart-card">
              <div class="chart-header">
                <div class="chart-title">Status dos Processos</div>
                <div class="chart-actions">
                  <button class="btn ghost" id="btnExportStatus">
                    <span class="material-icons">download</span> Excel
                  </button>
                </div>
              </div>
              <div class="chart-wrapper">
                <canvas id="chartStatus"></canvas>
              </div>
            </div>
            
            <div class="chart-card">
              <div class="chart-header">
                <div class="chart-title">Honorários por Categoria</div>
                <div class="chart-actions">
                  <button class="btn ghost" id="btnExportHonorarios">
                    <span class="material-icons">download</span> Excel
                  </button>
                </div>
              </div>
              <div class="chart-wrapper">
                <canvas id="chartHonorarios"></canvas>
              </div>
            </div>
            
            <div class="chart-card">
              <div class="chart-header">
                <div class="chart-title">Processos por Mês</div>
                <div class="chart-actions">
                  <button class="btn ghost" id="btnExportMensal">
                    <span class="material-icons">download</span> Excel
                  </button>
                </div>
              </div>
              <div class="chart-wrapper">
                <canvas id="chartMensal"></canvas>
              </div>
            </div>
            
            <div class="chart-card">
              <div class="chart-header">
                <div class="chart-title">Distribuição por Vara</div>
                <div class="chart-actions">
                  <button class="btn ghost" id="btnExportVara">
                    <span class="material-icons">download</span> Excel
                  </button>
                </div>
              </div>
              <div class="chart-wrapper">
                <canvas id="chartVara"></canvas>
              </div>
            </div>
          </div>
        </section>

        <!-- CADASTRO -->
        <section id="cadastro" class="container tab" style="display:none">
          <h2><span class="material-icons">person_add</span>Cadastro de Cliente & Processo</h2>
          <div id="alertCadastro"></div>
          <form id="formCadastro" style="margin-top:12px">
            <div class="grid">
              <div>
                <label>Nome completo *</label>
                <input name="nome" type="text" required placeholder="Ex: José da Silva" id="inputNome">

                <label>CPF</label>
                <input name="cpf" type="text" placeholder="000.000.000-00" id="inputCpf">

                <label>RG</label>
                <input name="rg" type="text" placeholder="" id="inputRg">
              </div>

              <div>
                <label>Telefone / WhatsApp</label>
                <input name="telefone" type="text" placeholder="(11) 9xxxx-xxxx" id="inputTelefone">

                <label>E-mail</label>
                <input name="email" type="email" placeholder="exemplo@dominio.com" id="inputEmail">

                <label>Responsável (advogado)</label>
                <input name="responsavel" type="text" placeholder="Dra. Advogada" value="Dra. Advogada" id="inputResponsavel">
              </div>

              <div class="col-full">
                <label>Endereço</label>
                <input name="endereco" type="text" placeholder="Rua, nº, bairro, cidade - UF" id="inputEndereco">
              </div>

              <div>
                <label>Categoria do processo</label>
                <select name="categoria" id="inputCategoria">
                  <option value="">Selecione...</option>
                  <option value="Cível">Cível</option>
                  <option value="Trabalhista">Trabalhista</option>
                  <option value="Penal">Penal</option>
                  <option value="Família">Família</option>
                  <option value="Consumidor">Consumidor</option>
                  <option value="Tributário">Tributário</option>
                  <option value="Administrativo">Administrativo</option>
                  <option value="Previdenciário">Previdenciário</option>
                  <option value="Outros">Outros</option>
                </select>

                <label>Número do processo</label>
                <input name="numero" type="text" placeholder="0001234-56.2025.8.26.0000" id="inputNumero">
              </div>

              <div>
                <label>Vara / Comarca</label>
                <input name="vara" type="text" placeholder="Ex: 3ª Vara Cível de São Paulo" id="inputVara">

                <label>Parte Contrária</label>
                <input name="parte" type="text" placeholder="Nome da parte contrária" id="inputParte">
              </div>

              <div>
                <label>Status do Processo</label>
                <select name="status" id="inputStatus">
                  <option value="Aguardando Distribuição">Aguardando Distribuição</option>
                  <option value="Em Andamento">Em Andamento</option>
                  <option value="Aguardando Decisão">Aguardando Decisão</option>
                  <option value="Suspenso">Suspenso</option>
                  <option value="Sentença Proferida">Sentença Proferida</option>
                  <option value="Em Recurso">Em Recurso</option>
                  <option value="Trânsito em Julgado">Trânsito em Julgado</option>
                  <option value="Arquivado">Arquivado</option>
                  <option value="Finalizado">Finalizado</option>
                </select>

                <label>Data de abertura</label>
                <input name="dataAbertura" type="date" id="inputDataAbertura">
              </div>

              <div>
                <label>Valor da causa (R$)</label>
                <input name="valor" type="number" step="0.01" placeholder="0.00" id="inputValor">

                <label>Honorários (R$)</label>
                <input name="honorarios" type="number" step="0.01" placeholder="0.00" id="inputHonorarios">
              </div>

              <div>
                <label>Forma de Pagamento</label>
                <select name="formaPagamento" id="formaPagamento">
                  <option value="">Selecione...</option>
                  <option value="À Vista">À Vista</option>
                  <option value="Parcelado">Parcelado</option>
                  <option value="Sucumbência">Sucumbência</option>
                  <option value="Êxito">Êxito (% sobre ganho)</option>
                  <option value="Pro Bono">Pro Bono</option>
                  <option value="Convênio">Convênio</option>
                </select>

                <label>Quantidade de Parcelas</label>
                <input name="parcelas" type="number" min="1" placeholder="Ex: 12" id="parcelasInput">
              </div>

              <div class="col-full">
                <label>Observações / Anotações</label>
                <textarea name="observacoes" placeholder="Anotações importantes, prazos, lembretes..." id="inputObservacoes"></textarea>
              </div>
            </div>

            <div class="actions">
              <button class="btn primary" type="submit">
                <span class="material-icons">save</span> Salvar Processo
              </button>
              <button type="button" class="btn success" id="btnGerarContrato">
                <span class="material-icons">description</span> Gerar Contrato
              </button>
              <button type="button" class="btn ghost" id="btnExportPdf">
                <span class="material-icons">picture_as_pdf</span> Exportar PDF
              </button>
              <button type="button" class="btn link" id="btnLimparForm">
                <span class="material-icons">clear</span> Limpar Formulário
              </button>
            </div>
          </form>
        </section>

        <!-- Outras seções (LISTA, PERFIL, CONTRATOS, etc.) permanecem como antes -->
        <!-- Para manter o foco nas melhorias, vou manter o código das outras seções como estava -->

      </main>
    </div>
  </div>

  <script>
    // ========== NOVAS FUNCIONALIDADES ==========
    
    // Gráficos interativos
    let chartStatus, chartHonorarios, chartMensal, chartVara;
    
    // Inicializar gráficos
    function inicializarGraficos() {
      const processos = carregarProcessos();
      criarGraficoStatus(processos);
      criarGraficoHonorarios(processos);
      criarGraficoMensal(processos);
      criarGraficoVara(processos);
    }
    
    // Gráfico de status dos processos
    function criarGraficoStatus(processos) {
      const ctx = document.getElementById('chartStatus').getContext('2d');
      
      // Contar processos por status
      const statusCount = {};
      processos.forEach(p => {
        statusCount[p.status] = (statusCount[p.status] || 0) + 1;
      });
      
      const labels = Object.keys(statusCount);
      const data = Object.values(statusCount);
      
      // Cores para os status
      const cores = [
        '#3366ff', '#2b61ff', '#0ea44e', '#f59e0b', '#ef4444',
        '#8b5cf6', '#06b6d4', '#84cc16', '#f97316', '#64748b'
      ];
      
      if (chartStatus) chartStatus.destroy();
      
      chartStatus = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: labels,
          datasets: [{
            data: data,
            backgroundColor: cores,
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'right',
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const label = context.label || '';
                  const value = context.raw || 0;
                  const total = context.dataset.data.reduce((a, b) => a + b, 0);
                  const percentage = Math.round((value / total) * 100);
                  return `${label}: ${value} (${percentage}%)`;
                }
              }
            }
          }
        }
      });
    }
    
    // Gráfico de honorários por categoria
    function criarGraficoHonorarios(processos) {
      const ctx = document.getElementById('chartHonorarios').getContext('2d');
      
      // Agrupar honorários por categoria
      const honorariosPorCategoria = {};
      processos.forEach(p => {
        if (p.honorarios && p.categoria) {
          const valor = parseFloat(p.honorarios) || 0;
          honorariosPorCategoria[p.categoria] = (honorariosPorCategoria[p.categoria] || 0) + valor;
        }
      });
      
      const labels = Object.keys(honorariosPorCategoria);
      const data = Object.values(honorariosPorCategoria);
      
      if (chartHonorarios) chartHonorarios.destroy();
      
      chartHonorarios = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Honorários (R$)',
            data: data,
            backgroundColor: '#3366ff',
            borderColor: '#2b61ff',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return 'R$ ' + value.toLocaleString('pt-BR');
                }
              }
            }
          },
          plugins: {
            tooltip: {
              callbacks: {
                label: function(context) {
                  return 'R$ ' + context.raw.toLocaleString('pt-BR');
                }
              }
            }
          }
        }
      });
    }
    
    // Gráfico de processos por mês
    function criarGraficoMensal(processos) {
      const ctx = document.getElementById('chartMensal').getContext('2d');
      
      // Agrupar processos por mês/ano
      const processosPorMes = {};
      processos.forEach(p => {
        if (p.dataAbertura) {
          const data = new Date(p.dataAbertura);
          const mesAno = `${data.getMonth() + 1}/${data.getFullYear()}`;
          processosPorMes[mesAno] = (processosPorMes[mesAno] || 0) + 1;
        }
      });
      
      // Ordenar por data
      const sortedEntries = Object.entries(processosPorMes)
        .sort((a, b) => {
          const [mesA, anoA] = a[0].split('/').map(Number);
          const [mesB, anoB] = b[0].split('/').map(Number);
          return new Date(anoA, mesA - 1) - new Date(anoB, mesB - 1);
        });
      
      const labels = sortedEntries.map(entry => entry[0]);
      const data = sortedEntries.map(entry => entry[1]);
      
      if (chartMensal) chartMensal.destroy();
      
      chartMensal = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Processos',
            data: data,
            backgroundColor: 'rgba(51, 102, 255, 0.1)',
            borderColor: '#3366ff',
            borderWidth: 2,
            tension: 0.3,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }
    
    // Gráfico de distribuição por vara
    function criarGraficoVara(processos) {
      const ctx = document.getElementById('chartVara').getContext('2d');
      
      // Contar processos por vara
      const varaCount = {};
      processos.forEach(p => {
        if (p.vara) {
          varaCount[p.vara] = (varaCount[p.vara] || 0) + 1;
        }
      });
      
      // Limitar a 10 varas mais comuns para evitar poluição visual
      const sortedVaras = Object.entries(varaCount)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 10);
      
      const labels = sortedVaras.map(entry => {
        // Abreviar nomes longos
        const nome = entry[0];
        return nome.length > 20 ? nome.substring(0, 20) + '...' : nome;
      });
      const data = sortedVaras.map(entry => entry[1]);
      
      if (chartVara) chartVara.destroy();
      
      chartVara = new Chart(ctx, {
        type: 'horizontalBar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Processos',
            data: data,
            backgroundColor: '#0ea44e',
            borderColor: '#0d9c48',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          indexAxis: 'y',
          scales: {
            x: {
              beginAtZero: true
            }
          }
        }
      });
    }
    
    // ========== EXPORTAÇÃO DE DADOS DOS GRÁFICOS ==========
    
    // Exportar dados do gráfico de status
    document.getElementById('btnExportStatus').addEventListener('click', () => {
      const processos = carregarProcessos();
      const statusCount = {};
      processos.forEach(p => {
        statusCount[p.status] = (statusCount[p.status] || 0) + 1;
      });
      
      const dados = Object.entries(statusCount).map(([status, count]) => ({
        Status: status,
        Quantidade: count
      }));
      
      exportarParaExcel(dados, 'status-processos');
    });
    
    // Exportar dados do gráfico de honorários
    document.getElementById('btnExportHonorarios').addEventListener('click', () => {
      const processos = carregarProcessos();
      const honorariosPorCategoria = {};
      processos.forEach(p => {
        if (p.honorarios && p.categoria) {
          const valor = parseFloat(p.honorarios) || 0;
          honorariosPorCategoria[p.categoria] = (honorariosPorCategoria[p.categoria] || 0) + valor;
        }
      });
      
      const dados = Object.entries(honorariosPorCategoria).map(([categoria, valor]) => ({
        Categoria: categoria,
        'Honorários (R$)': valor
      }));
      
      exportarParaExcel(dados, 'honorarios-categoria');
    });
    
    // Exportar dados do gráfico mensal
    document.getElementById('btnExportMensal').addEventListener('click', () => {
      const processos = carregarProcessos();
      const processosPorMes = {};
      processos.forEach(p => {
        if (p.dataAbertura) {
          const data = new Date(p.dataAbertura);
          const mesAno = `${data.getMonth() + 1}/${data.getFullYear()}`;
          processosPorMes[mesAno] = (processosPorMes[mesAno] || 0) + 1;
        }
      });
      
      const sortedEntries = Object.entries(processosPorMes)
        .sort((a, b) => {
          const [mesA, anoA] = a[0].split('/').map(Number);
          const [mesB, anoB] = b[0].split('/').map(Number);
          return new Date(anoA, mesA - 1) - new Date(anoB, mesB - 1);
        });
      
      const dados = sortedEntries.map(([mesAno, count]) => ({
        'Mês/Ano': mesAno,
        'Quantidade de Processos': count
      }));
      
      exportarParaExcel(dados, 'processos-mensal');
    });
    
    // Exportar dados do gráfico de vara
    document.getElementById('btnExportVara').addEventListener('click', () => {
      const processos = carregarProcessos();
      const varaCount = {};
      processos.forEach(p => {
        if (p.vara) {
          varaCount[p.vara] = (varaCount[p.vara] || 0) + 1;
        }
      });
      
      const sortedVaras = Object.entries(varaCount)
        .sort((a, b) => b[1] - a[1]);
      
      const dados = sortedVaras.map(([vara, count]) => ({
        Vara: vara,
        'Quantidade de Processos': count
      }));
      
      exportarParaExcel(dados, 'processos-vara');
    });
    
    // Função genérica para exportar dados para Excel
    function exportarParaExcel(dados, nomeArquivo) {
      const ws = XLSX.utils.json_to_sheet(dados);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Dados");
      XLSX.writeFile(wb, `${nomeArquivo}-${Date.now()}.xlsx`);
    }
    
    // ========== CRIAÇÃO AUTOMÁTICA DE CONTRATO ==========
    
    // Modificar a função de salvar processo para criar contrato automaticamente
    document.getElementById('formCadastro').addEventListener('submit', (e) => {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const processo = {
        id: Date.now().toString(),
        dataCadastro: new Date().toISOString(),
        nome: formData.get('nome'),
        cpf: formData.get('cpf'),
        rg: formData.get('rg'),
        telefone: formData.get('telefone'),
        email: formData.get('email'),
        responsavel: formData.get('responsavel'),
        endereco: formData.get('endereco'),
        categoria: formData.get('categoria'),
        numero: formData.get('numero'),
        vara: formData.get('vara'),
        parte: formData.get('parte'),
        status: formData.get('status'),
        dataAbertura: formData.get('dataAbertura'),
        valor: formData.get('valor'),
        honorarios: formData.get('honorarios'),
        formaPagamento: formData.get('formaPagamento'),
        parcelas: formData.get('parcelas'),
        observacoes: formData.get('observacoes')
      };
      
      const processos = carregarProcessos();
      processos.push(processo);
      salvarProcessos(processos);
      
      // Criar contrato automaticamente
      criarContratoAutomatico(processo);
      
      mostrarAlerta('alertCadastro', 'Processo salvo e contrato criado automaticamente!', 'success');
      
      // Limpar formulário
      e.target.reset();
      document.getElementById('parcelasInput').disabled = true;
      
      // Atualizar dashboard e gráficos
      atualizarDashboard();
      inicializarGraficos();
      
      setTimeout(() => {
        document.getElementById('alertCadastro').innerHTML = '';
      }, 3000);
    });
    
    // Função para criar contrato automaticamente
    function criarContratoAutomatico(processo) {
      const contrato = {
        id: Date.now().toString(),
        dataCriacao: new Date().toISOString(),
        cliente: processo.nome,
        cpf: processo.cpf,
        endereco: processo.endereco,
        categoria: processo.categoria,
        numeroProcesso: processo.numero,
        vara: processo.vara,
        parteContraria: processo.parte,
        valorCausa: processo.valor,
        honorarios: processo.honorarios,
        formaPagamento: processo.formaPagamento,
        parcelas: processo.parcelas,
        geradoAutomaticamente: true
      };
      
      const contratos = carregarContratos();
      contratos.push(contrato);
      salvarContratos(contratos);
    }
    
    // ========== OTIMIZAÇÃO DE PERFORMANCE ==========
    
    // Cache para processos carregados
    let cacheProcessos = null;
    let cacheTimestamp = null;
    const CACHE_DURATION = 30000; // 30 segundos
    
    // Função otimizada para carregar processos
    function carregarProcessosOtimizado() {
      const agora = Date.now();
      
      // Se o cache existe e ainda é válido, retornar do cache
      if (cacheProcessos && cacheTimestamp && (agora - cacheTimestamp < CACHE_DURATION)) {
        return cacheProcessos;
      }
      
      // Caso contrário, carregar do localStorage e atualizar cache
      const data = localStorage.getItem(DB_KEY);
      cacheProcessos = data ? JSON.parse(data) : [];
      cacheTimestamp = agora;
      
      return cacheProcessos;
    }
    
    // Função para invalidar o cache quando necessário
    function invalidarCacheProcessos() {
      cacheProcessos = null;
      cacheTimestamp = null;
    }
    
    // ========== INICIALIZAÇÃO ==========
    document.addEventListener('DOMContentLoaded', function() {
      // Substituir a função original por versão otimizada
      window.carregarProcessos = carregarProcessosOtimizado;
      
      // Configurar data atual nos campos de data
      const hoje = new Date().toISOString().split('T')[0];
      document.getElementById('dataInteracao').value = hoje;
      document.getElementById('dataInicial').value = hoje;
      
      // Inicializar dados
      renderizarTabela();
      atualizarSelectProcessos();
      atualizarSelectProcessosInteracao();
      atualizarSelectClientesPerfil();
      atualizarDashboard();
      atualizarContrato();
      renderizarContratosCriados();
      
      // Inicializar gráficos
      inicializarGraficos();
      
      // Adicionar dados de exemplo se não houver dados
      const processos = carregarProcessos();
      if (processos.length === 0) {
        // Adicionar processo de exemplo
        const processoExemplo = {
          id: 'exemplo-1',
          dataCadastro: new Date().toISOString(),
          nome: 'João Silva Santos',
          cpf: '123.456.789-00',
          rg: '12.345.678-9',
          telefone: '(11) 99999-1234',
          email: 'joao.silva@email.com',
          responsavel: 'Dra. Advogada',
          endereco: 'Rua das Flores, 123, Centro, São Paulo - SP',
          categoria: 'Cível',
          numero: '0001234-56.2024.8.26.0001',
          vara: '3ª Vara Cível de São Paulo',
          parte: 'Empresa XYZ Ltda',
          status: 'Em Andamento',
          dataAbertura: '2024-01-15',
          valor: '50000',
          honorarios: '5000',
          formaPagamento: 'Parcelado',
          parcelas: '10',
          observacoes: 'Processo sobre cobrança indevida.'
        };
        
        processos.push(processoExemplo);
        salvarProcessos(processos);
        invalidarCacheProcessos(); // Invalidar cache após salvar
        
        // Adicionar anotação de exemplo
        const anotacoes = carregarAnotacoes();
        anotacoes.push({
          id: 'exemplo-anotacao-1',
          processoId: 'exemplo-1',
          texto: 'Primeira audiência marcada para 15/03/2024.',
          data: new Date().toISOString()
        });
        salvarAnotacoes(anotacoes);
        
        // Adicionar interação de exemplo
        const interacoes = carregarInteracoes();
        interacoes.push({
          id: 'exemplo-interacao-1',
          processoId: 'exemplo-1',
          tipo: 'reuniao',
          data: new Date().toISOString(),
          detalhes: 'Reunião inicial com cliente para apresentação do caso.'
        });
        salvarInteracoes(interacoes);
        
        // Atualizar interface
        renderizarTabela();
        atualizarDashboard();
        inicializarGraficos();
      }
    });

    // ========== NAVEGAÇÃO ENTRE ABAS ==========
    document.querySelectorAll('.nav-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const tab = btn.dataset.tab;
        
        // Atualizar botões ativos
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        // Mostrar aba correspondente
        document.querySelectorAll('.tab').forEach(t => t.style.display = 'none');
        document.getElementById(tab).style.display = 'block';
        
        // Atualizar título
        const titulos = {
          'dashboard': 'Dashboard',
          'cadastro': 'Cadastro',
          'lista': 'Processos Registrados',
          'perfil': 'Perfil do Cliente',
          'contratos': 'Contratos',
          'contratos-criados': 'Contratos Criados',
          'anotacoes': 'Anotações',
          'interacao': 'Interação com Cliente',
          'ferramentas': 'Ferramentas'
        };
        document.getElementById('pageTitle').textContent = titulos[tab];
        
        // Atualizar lista se for aba de processos
        if (tab === 'lista') {
          renderizarTabela();
        }
        
        // Atualizar anotações
        if (tab === 'anotacoes') {
          atualizarSelectProcessos();
          renderizarAnotacoes();
        }

        // Atualizar interações
        if (tab === 'interacao') {
          atualizarSelectProcessosInteracao();
          renderizarInteracoes();
        }

        // Atualizar contratos criados
        if (tab === 'contratos-criados') {
          renderizarContratosCriados();
        }

        // Atualizar perfil
        if (tab === 'perfil') {
          atualizarSelectClientesPerfil();
        }

        // Atualizar dashboard e gráficos
        if (tab === 'dashboard') {
          atualizarDashboard();
          inicializarGraficos();
        }
      });
    });

    // ========== FUNÇÕES EXISTENTES ==========
    // (Manter todas as funções existentes do código anterior)
    // Por questão de espaço, mantive apenas as partes essenciais

    // ========== ARMAZENAMENTO ==========
    const DB_KEY = 'processos_juridicos';
    const NOTES_KEY = 'anotacoes_juridicas';
    const CONTRATOS_KEY = 'contratos_gerados';
    const INTERACOES_KEY = 'interacoes_clientes';

    function salvarProcessos(processos) {
      localStorage.setItem(DB_KEY, JSON.stringify(processos));
      invalidarCacheProcessos(); // Invalidar cache ao salvar
      atualizarDashboard();
    }

    function carregarProcessos() {
      return carregarProcessosOtimizado(); // Usar versão otimizada
    }

    function salvarAnotacoes(anotacoes) {
      localStorage.setItem(NOTES_KEY, JSON.stringify(anotacoes));
    }

    function carregarAnotacoes() {
      const data = localStorage.getItem(NOTES_KEY);
      return data ? JSON.parse(data) : [];
    }

    function salvarContratos(contratos) {
      localStorage.setItem(CONTRATOS_KEY, JSON.stringify(contratos));
    }

    function carregarContratos() {
      const data = localStorage.getItem(CONTRATOS_KEY);
      return data ? JSON.parse(data) : [];
    }

    function salvarInteracoes(interacoes) {
      localStorage.setItem(INTERACOES_KEY, JSON.stringify(interacoes));
    }

    function carregarInteracoes() {
      const data = localStorage.getItem(INTERACOES_KEY);
      return data ? JSON.parse(data) : [];
    }

    // ========== DASHBOARD ==========
    function atualizarDashboard() {
      const processos = carregarProcessos();
      const processosAtivos = processos.filter(p => 
        p.status !== 'Arquivado' && p.status !== 'Finalizado' && p.status !== 'Trânsito em Julgado'
      );
      
      const honorariosMensais = processos.reduce((total, p) => {
        return total + (parseFloat(p.honorarios) || 0);
      }, 0);
      
      const clientesUnicos = [...new Set(processos.map(p => p.cpf))].length;
      
      document.getElementById('totalProcessos').textContent = processos.length;
      document.getElementById('processosAtivos').textContent = processosAtivos.length;
      document.getElementById('honorariosMensais').textContent = `R$ ${honorariosMensais.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
      document.getElementById('clientesAtivos').textContent = clientesUnicos;
    }

    // ========== UTILITÁRIOS ==========
    function mostrarAlerta(containerId, mensagem, tipo) {
      const container = document.getElementById(containerId);
      container.innerHTML = `<div class="alert ${tipo}">
        <span class="material-icons">${tipo === 'success' ? 'check_circle' : 'error'}</span>
        ${mensagem}
      </div>`;
    }

    // Outras funções existentes (renderizarTabela, atualizarSelectProcessos, etc.)
    // Devem ser mantidas conforme o código original
  </script>
</body>
</html>
