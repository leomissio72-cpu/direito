<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sistema Jurídico</title>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    :root{
      --bg:#f4f6fb;
      --sidebar:#0f1724;
      --card:#ffffff;
      --muted:#556179;
      --primary:#3366ff;
      --accent:#2b61ff;
      --success:#0ea44e;
      --warning:#f59e0b;
      --danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:'Inter',sans-serif;background:var(--bg);color:#0b1b2b}
    .app{display:flex;min-height:100vh}

    /* SIDEBAR */
    .sidebar{
      width:220px;padding:20px;background:#0f1724;color:#fff;display:flex;flex-direction:column;gap:18px;
    }
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--primary),var(--accent));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
    .brand h3{margin:0;font-size:16px}
    nav{display:flex;flex-direction:column;gap:8px;margin-top:10px}
    .nav-btn{display:flex;align-items:center;gap:10px;padding:10px;border-radius:8px;border:none;background:transparent;color:rgba(255,255,255,0.9);cursor:pointer;font-weight:600;text-align:left;width:100%}
    .nav-btn:hover{background:rgba(255,255,255,0.04)}
    .nav-btn.active{background:rgba(255,255,255,0.06)}
    .sidebar-footer{margin-top:auto;color:var(--muted);font-size:13px}

    /* WORKSPACE */
    .workspace{flex:1;display:flex;flex-direction:column;min-width:0}
    .topbar{height:68px;display:flex;align-items:center;justify-content:space-between;padding:0 20px;background:transparent;border-bottom:1px solid rgba(16,24,40,0.04)}
    .page-title{font-size:18px;font-weight:700;color:#0b1b2b}
    .user-area{display:flex;align-items:center;gap:12px}
    .avatar{width:40px;height:40px;border-radius:8px;background:linear-gradient(135deg,var(--primary),var(--accent));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}

    .main-area{padding:18px;overflow:auto}
    .container{background:var(--card);border-radius:12px;padding:18px;border:1px solid rgba(11,27,43,0.04);box-shadow:0 8px 24px rgba(11,27,43,0.04);margin-bottom:16px}
    h2{margin:0 0 8px 0;color:#0b1b2b}

    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .col-full{grid-column:1/-1}
    label{display:block;margin-top:10px;color:var(--muted);font-weight:600;font-size:13px}
    input,select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(11,27,43,0.06);background:#fff;color:#0b1b2b;font-family:'Inter',sans-serif;font-size:14px}
    textarea{min-height:100px;resize:vertical}
    .actions{display:flex;gap:10px;align-items:center;margin-top:14px;flex-wrap:wrap}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:8px;border:none;cursor:pointer;font-weight:700;font-size:14px;transition:opacity 0.2s}
    .btn:hover{opacity:0.9}
    .btn.primary{background:linear-gradient(90deg,var(--primary),var(--accent));color:#fff}
    .btn.ghost{background:transparent;border:1px solid rgba(11,27,43,0.06);color:#0b1b2b}
    .btn.link{background:transparent;color:var(--muted);text-decoration:underline;padding:8px}
    .btn.danger{background:var(--danger);color:#fff}

    table{width:100%;border-collapse:collapse;margin-top:12px;color:#0b1b2b}
    th,td{padding:10px;border-bottom:1px solid rgba(11,27,43,0.04);text-align:left;font-size:14px}
    th{color:var(--muted);font-weight:700}
    td .btn{padding:6px 10px;font-size:13px}

    .no-data{color:var(--muted);padding:18px;text-align:center}
    .note-card{background:#fafbff;border-left:4px solid var(--primary);padding:12px;border-radius:8px;margin-bottom:10px}
    .note-meta{font-size:13px;color:var(--muted);margin-bottom:6px}
    .note-text{font-size:14px;color:#0b1b2b}

    .alert{padding:12px 16px;border-radius:8px;margin-bottom:12px;font-size:14px}
    .alert.success{background:#d1fae5;color:#065f46;border:1px solid #10b981}
    .alert.error{background:#fee2e2;color:#991b1b;border:1px solid #ef4444}

    @media (max-width:980px){
      .grid{grid-template-columns:1fr}
      .sidebar{width:64px}
      .brand h3,.sidebar-footer{display:none}
      .nav-btn .label{display:none}
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">J</div>
        <div>
          <h3>Sistema Jurídico</h3>
          <div style="font-size:12px;color:var(--muted)">Escritório</div>
        </div>
      </div>

      <nav>
        <button class="nav-btn active" data-tab="cadastro">
          <span class="material-icons">person_add</span>
          <span class="label">Cadastro</span>
        </button>
        <button class="nav-btn" data-tab="lista">
          <span class="material-icons">folder_open</span>
          <span class="label">Processos</span>
        </button>
        <button class="nav-btn" data-tab="anotacoes">
          <span class="material-icons">note_add</span>
          <span class="label">Anotações</span>
        </button>
        <button class="nav-btn" data-tab="ferramentas">
          <span class="material-icons">build</span>
          <span class="label">Ferramentas</span>
        </button>
      </nav>

      <div class="sidebar-footer">
        <div style="font-size:12px;margin-top:8px">
          <strong>Armazenamento:</strong> Local
        </div>
        <div style="font-size:11px;color:rgba(255,255,255,0.5);margin-top:4px">
          Os dados são salvos no navegador
        </div>
      </div>
    </aside>

    <!-- WORKSPACE -->
    <div class="workspace">
      <div class="topbar">
        <div class="page-title" id="pageTitle">Cadastro</div>
        <div class="user-area">
          <div style="text-align:right">
            <div id="userName" style="font-weight:700">Sistema Local</div>
            <div style="font-size:12px;color:var(--muted)">Armazenamento do navegador</div>
          </div>
          <div class="avatar">⚖️</div>
        </div>
      </div>

      <main class="main-area">
        <!-- CADASTRO -->
        <section id="cadastro" class="container tab" style="display:block">
          <h2>Cadastro de Cliente & Processo</h2>
          <div id="alertCadastro"></div>
          <form id="formCadastro" style="margin-top:12px">
            <div class="grid">
              <div>
                <label>Nome completo *</label>
                <input name="nome" type="text" required placeholder="Ex: José da Silva">

                <label>CPF</label>
                <input name="cpf" type="text" placeholder="000.000.000-00">

                <label>RG</label>
                <input name="rg" type="text" placeholder="">
              </div>

              <div>
                <label>Telefone / WhatsApp</label>
                <input name="telefone" type="text" placeholder="(11) 9xxxx-xxxx">

                <label>E-mail</label>
                <input name="email" type="email" placeholder="exemplo@dominio.com">

                <label>Responsável (advogado)</label>
                <input name="responsavel" type="text" placeholder="Adv. Fulano">
              </div>

              <div class="col-full">
                <label>Endereço</label>
                <input name="endereco" type="text" placeholder="Rua, nº, bairro, cidade - UF">
              </div>

              <div>
                <label>Categoria do processo</label>
                <select name="categoria">
                  <option value="">Selecione...</option>
                  <option value="Cível">Cível</option>
                  <option value="Trabalhista">Trabalhista</option>
                  <option value="Penal">Penal</option>
                  <option value="Família">Família</option>
                  <option value="Consumidor">Consumidor</option>
                  <option value="Outros">Outros</option>
                </select>

                <label>Número do processo</label>
                <input name="numero" type="text" placeholder="0001234-56.2025.8.26.0000">
              </div>

              <div>
                <label>Vara / Comarca</label>
                <input name="vara" type="text" placeholder="Ex: 3ª Vara Cível de São Paulo">

                <label>Parte Contrária</label>
                <input name="parte" type="text" placeholder="Nome da parte contrária">
              </div>

              <div>
                <label>Status</label>
                <select name="status">
                  <option value="Em andamento">Em andamento</option>
                  <option value="Finalizado">Finalizado</option>
                </select>

                <label>Data de abertura</label>
                <input name="dataAbertura" type="date">
              </div>

              <div>
                <label>Valor da causa (R$)</label>
                <input name="valor" type="number" step="0.01" placeholder="0.00">

                <label>Honorários (R$)</label>
                <input name="honorarios" type="number" step="0.01" placeholder="0.00">
              </div>

              <div class="col-full">
                <label>Observações / Anotações</label>
                <textarea name="observacoes" placeholder="Anotações importantes, prazos, lembretes..."></textarea>
              </div>
            </div>

            <div class="actions">
              <button class="btn primary" type="submit">
                <span class="material-icons">save</span> Salvar Processo
              </button>
              <button type="button" class="btn ghost" id="btnExportPdf">
                <span class="material-icons">picture_as_pdf</span> Exportar PDF
              </button>
              <button type="button" class="btn link" id="btnLimparForm">
                Limpar Formulário
              </button>
            </div>
          </form>
        </section>

        <!-- LISTA -->
        <section id="lista" class="container tab" style="display:none">
          <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px">
            <h2>Processos Registrados</h2>
            <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
              <input id="searchInput" placeholder="Pesquisar..." style="padding:8px;border-radius:8px;border:1px solid rgba(11,27,43,0.06);min-width:200px">
              <button class="btn ghost" id="btnRefresh">
                <span class="material-icons">refresh</span> Atualizar
              </button>
              <button class="btn ghost" id="btnDownloadCsv">
                <span class="material-icons">download</span> CSV
              </button>
              <button class="btn ghost" id="btnSortDate">
                <span class="material-icons">sort</span> Data
              </button>
            </div>
          </div>

          <div id="tableWrapper" style="margin-top:12px;overflow-x:auto">
            <div class="no-data">Carregando registros...</div>
          </div>
        </section>

        <!-- ANOTAÇÕES -->
        <section id="anotacoes" class="container tab" style="display:none">
          <h2>Anotações</h2>
          <div id="alertAnotacoes"></div>

          <div style="display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px">
            <div style="flex:1;min-width:220px">
              <label>Processo (selecionar)</label>
              <select id="selectProcesso" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(11,27,43,0.06);background:#fff;color:#0b1b2b">
                <option value="">--- selecione um processo ---</option>
              </select>
            </div>

            <div style="flex:1;min-width:220px">
              <label>Adicionar anotação</label>
              <input id="inputAnotacao" placeholder="Digite a anotação..." style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(11,27,43,0.06);background:#fff;color:#0b1b2b">
            </div>

            <div style="display:flex;align-items:end">
              <button class="btn primary" id="btnSalvarAnotacao">
                <span class="material-icons">note_add</span> Salvar
              </button>
            </div>
          </div>

          <div id="listaAnotacoes"></div>
        </section>

        <!-- FERRAMENTAS -->
        <section id="ferramentas" class="container tab" style="display:none">
          <h2>Calculadora de Prazos Processuais</h2>
          
          <div class="grid" style="margin-top:12px">
            <div>
              <label>Data Inicial</label>
              <input type="date" id="dataInicial">
              
              <label>Tipo de Prazo</label>
              <select id="tipoPrazo">
                <option value="corrido">Dias Corridos</option>
                <option value="uteis">Dias Úteis</option>
              </select>
            </div>

            <div>
              <label>Quantidade de Dias</label>
              <input type="number" id="quantidadeDias" placeholder="Ex: 15" min="1">
              
              <label style="visibility:hidden">Espaço</label>
              <button class="btn primary" id="btnCalcularPrazo" style="width:100%">
                <span class="material-icons">calculate</span> Calcular
              </button>
            </div>

            <div class="col-full" id="resultadoPrazo" style="display:none;background:#fafbff;padding:16px;border-radius:8px;border:2px solid var(--primary)">
              <div style="font-weight:700;color:var(--primary);margin-bottom:8px">Resultado:</div>
              <div id="resultadoTexto" style="font-size:16px;color:#0b1b2b"></div>
            </div>
          </div>

          <hr style="margin:24px 0;border:none;border-top:1px solid rgba(11,27,43,0.06)">

          <h2 style="margin-top:24px">Gerenciar Dados</h2>
          <div style="margin-top:12px">
            <button class="btn danger" id="btnLimparTodos">
              <span class="material-icons">delete_forever</span> Limpar Todos os Dados
            </button>
            <p style="color:var(--muted);margin-top:8px;font-size:13px">
              Atenção: Esta ação removerá todos os processos e anotações salvos. Não é possível desfazer.
            </p>
          </div>
        </section>
      </main>
    </div>
  </div>

  <script>
    // ========== ARMAZENAMENTO ==========
    const DB_KEY = 'processos_juridicos';
    const NOTES_KEY = 'anotacoes_juridicas';

    function salvarProcessos(processos) {
      localStorage.setItem(DB_KEY, JSON.stringify(processos));
    }

    function carregarProcessos() {
      const data = localStorage.getItem(DB_KEY);
      return data ? JSON.parse(data) : [];
    }

    function salvarAnotacoes(anotacoes) {
      localStorage.setItem(NOTES_KEY, JSON.stringify(anotacoes));
    }

    function carregarAnotacoes() {
      const data = localStorage.getItem(NOTES_KEY);
      return data ? JSON.parse(data) : [];
    }

    // ========== NAVEGAÇÃO ENTRE ABAS ==========
    document.querySelectorAll('.nav-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const tab = btn.dataset.tab;
        
        // Atualizar botões ativos
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        // Mostrar aba correspondente
        document.querySelectorAll('.tab').forEach(t => t.style.display = 'none');
        document.getElementById(tab).style.display = 'block';
        
        // Atualizar título
        const titulos = {
          'cadastro': 'Cadastro',
          'lista': 'Processos Registrados',
          'anotacoes': 'Anotações',
          'ferramentas': 'Ferramentas'
        };
        document.getElementById('pageTitle').textContent = titulos[tab];
        
        // Atualizar lista se for aba de processos
        if (tab === 'lista') {
          renderizarTabela();
        }
        
        // Atualizar anotações
        if (tab === 'anotacoes') {
          atualizarSelectProcessos();
          renderizarAnotacoes();
        }
      });
    });

    // ========== FORMULÁRIO DE CADASTRO ==========
    document.getElementById('formCadastro').addEventListener('submit', (e) => {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const processo = {
        id: Date.now().toString(),
        dataCadastro: new Date().toISOString(),
        nome: formData.get('nome'),
        cpf: formData.get('cpf'),
        rg: formData.get('rg'),
        telefone: formData.get('telefone'),
        email: formData.get('email'),
        responsavel: formData.get('responsavel'),
        endereco: formData.get('endereco'),
        categoria: formData.get('categoria'),
        numero: formData.get('numero'),
        vara: formData.get('vara'),
        parte: formData.get('parte'),
        status: formData.get('status'),
        dataAbertura: formData.get('dataAbertura'),
        valor: formData.get('valor'),
        honorarios: formData.get('honorarios'),
        observacoes: formData.get('observacoes')
      };
      
      const processos = carregarProcessos();
      processos.push(processo);
      salvarProcessos(processos);
      
      mostrarAlerta('alertCadastro', 'Processo salvo com sucesso!', 'success');
      e.target.reset();
      
      setTimeout(() => {
        document.getElementById('alertCadastro').innerHTML = '';
      }, 3000);
    });

    // Limpar formulário
    document.getElementById('btnLimparForm').addEventListener('click', () => {
      document.getElementById('formCadastro').reset();
    });

    // ========== EXPORTAR PDF ==========
    document.getElementById('btnExportPdf').addEventListener('click', () => {
      const form = document.getElementById('formCadastro');
      const formData = new FormData(form);
      
      if (!formData.get('nome')) {
        alert('Preencha pelo menos o nome do cliente para exportar.');
        return;
      }
      
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      doc.setFontSize(18);
      doc.text('Cadastro de Processo - Sistema Jurídico', 20, 20);
      
      doc.setFontSize(12);
      let y = 40;
      
      const campos = [
        ['Nome', formData.get('nome')],
        ['CPF', formData.get('cpf')],
        ['RG', formData.get('rg')],
        ['Telefone', formData.get('telefone')],
        ['E-mail', formData.get('email')],
        ['Responsável', formData.get('responsavel')],
        ['Endereço', formData.get('endereco')],
        ['Categoria', formData.get('categoria')],
        ['Número do Processo', formData.get('numero')],
        ['Vara/Comarca', formData.get('vara')],
        ['Parte Contrária', formData.get('parte')],
        ['Status', formData.get('status')],
        ['Data de Abertura', formData.get('dataAbertura')],
        ['Valor da Causa', formData.get('valor') ? `R$ ${formData.get('valor')}` : ''],
        ['Honorários', formData.get('honorarios') ? `R$ ${formData.get('honorarios')}` : ''],
      ];
      
      campos.forEach(([label, value]) => {
        if (value) {
          doc.setFont(undefined, 'bold');
          doc.text(`${label}:`, 20, y);
          doc.setFont(undefined, 'normal');
          doc.text(value, 70, y);
          y += 10;
        }
      });
      
      if (formData.get('observacoes')) {
        y += 5;
        doc.setFont(undefined, 'bold');
        doc.text('Observações:', 20, y);
        y += 7;
        doc.setFont(undefined, 'normal');
        const obs = doc.splitTextToSize(formData.get('observacoes'), 170);
        doc.text(obs, 20, y);
      }
      
      doc.save(`processo-${Date.now()}.pdf`);
      mostrarAlerta('alertCadastro', 'PDF exportado com sucesso!', 'success');
      setTimeout(() => {
        document.getElementById('alertCadastro').innerHTML = '';
      }, 3000);
    });

    // ========== LISTA DE PROCESSOS ==========
    let processosFiltrados = [];
    let ordenacaoData = 'desc';

    function renderizarTabela(filtro = '') {
      const processos = carregarProcessos();
      processosFiltrados = processos.filter(p => {
        if (!filtro) return true;
        const busca = filtro.toLowerCase();
        return (
          p.nome.toLowerCase().includes(busca) ||
          (p.cpf && p.cpf.includes(busca)) ||
          (p.numero && p.numero.includes(busca)) ||
          (p.categoria && p.categoria.toLowerCase().includes(busca))
        );
      });
      
      const wrapper = document.getElementById('tableWrapper');
      
      if (processosFiltrados.length === 0) {
        wrapper.innerHTML = '<div class="no-data">Nenhum processo encontrado.</div>';
        return;
      }
      
      let html = '<table><thead><tr>';
      html += '<th>Nome</th><th>Categoria</th><th>Número</th><th>Status</th><th>Data Abertura</th><th>Ações</th>';
      html += '</tr></thead><tbody>';
      
      processosFiltrados.forEach(p => {
        html += '<tr>';
        html += `<td>${p.nome}</td>`;
        html += `<td>${p.categoria || '-'}</td>`;
        html += `<td>${p.numero || '-'}</td>`;
        html += `<td>${p.status}</td>`;
        html += `<td>${p.dataAbertura ? new Date(p.dataAbertura).toLocaleDateString('pt-BR') : '-'}</td>`;
        html += `<td>
          <button class="btn ghost" onclick="verDetalhes('${p.id}')">
            <span class="material-icons">visibility</span> Ver
          </button>
          <button class="btn danger" onclick="deletarProcesso('${p.id}')">
            <span class="material-icons">delete</span>
          </button>
        </td>`;
        html += '</tr>';
      });
      
      html += '</tbody></table>';
      wrapper.innerHTML = html;
    }

    // Busca
    document.getElementById('searchInput').addEventListener('input', (e) => {
      renderizarTabela(e.target.value);
    });

    // Atualizar
    document.getElementById('btnRefresh').addEventListener('click', () => {
      renderizarTabela();
    });

    // Ordenar por data
    document.getElementById('btnSortDate').addEventListener('click', () => {
      const processos = carregarProcessos();
      ordenacaoData = ordenacaoData === 'desc' ? 'asc' : 'desc';
      
      processos.sort((a, b) => {
        const dataA = new Date(a.dataAbertura || a.dataCadastro);
        const dataB = new Date(b.dataAbertura || b.dataCadastro);
        return ordenacaoData === 'desc' ? dataB - dataA : dataA - dataB;
      });
      
      salvarProcessos(processos);
      renderizarTabela();
    });

    // Download CSV
    document.getElementById('btnDownloadCsv').addEventListener('click', () => {
      const processos = processosFiltrados.length > 0 ? processosFiltrados : carregarProcessos();
      
      if (processos.length === 0) {
        alert('Nenhum processo para exportar.');
        return;
      }
      
      let csv = 'Nome,CPF,Telefone,Email,Categoria,Número,Status,Data Abertura,Valor,Honorários\n';
      
      processos.forEach(p => {
        csv += `"${p.nome}","${p.cpf || ''}","${p.telefone || ''}","${p.email || ''}","${p.categoria || ''}","${p.numero || ''}","${p.status}","${p.dataAbertura || ''}","${p.valor || ''}","${p.honorarios || ''}"\n`;
      });
      
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `processos-${Date.now()}.csv`;
      link.click();
    });

    // Ver detalhes
    window.verDetalhes = function(id) {
      const processos = carregarProcessos();
      const processo = processos.find(p => p.id === id);
      if (!processo) return;
      
      let detalhes = 'DETALHES DO PROCESSO\n\n';
      detalhes += `Nome: ${processo.nome}\n`;
      detalhes += `CPF: ${processo.cpf || '-'}\n`;
      detalhes += `RG: ${processo.rg || '-'}\n`;
      detalhes += `Telefone: ${processo.telefone || '-'}\n`;
      detalhes += `Email: ${processo.email || '-'}\n`;
      detalhes += `Responsável: ${processo.responsavel || '-'}\n`;
      detalhes += `Endereço: ${processo.endereco || '-'}\n`;
      detalhes += `Categoria: ${processo.categoria || '-'}\n`;
      detalhes += `Número: ${processo.numero || '-'}\n`;
      detalhes += `Vara: ${processo.vara || '-'}\n`;
      detalhes += `Parte Contrária: ${processo.parte || '-'}\n`;
      detalhes += `Status: ${processo.status}\n`;
      detalhes += `Data Abertura: ${processo.dataAbertura || '-'}\n`;
      detalhes += `Valor da Causa: R$ ${processo.valor || '0'}\n`;
      detalhes += `Honorários: R$ ${processo.honorarios || '0'}\n`;
      detalhes += `Observações: ${processo.observacoes || '-'}\n`;
      
      alert(detalhes);
    };

    // Deletar processo
    window.deletarProcesso = function(id) {
      if (!confirm('Deseja realmente deletar este processo?')) return;
      
      let processos = carregarProcessos();
      processos = processos.filter(p => p.id !== id);
      salvarProcessos(processos);
      
      renderizarTabela();
    };

    // ========== ANOTAÇÕES ==========
    function atualizarSelectProcessos() {
      const processos = carregarProcessos();
      const select = document.getElementById('selectProcesso');
      
      select.innerHTML = '<option value="">--- selecione um processo ---</option>';
      
      processos.forEach(p => {
        const option = document.createElement('option');
        option.value = p.id;
        option.textContent = `${p.nome} - ${p.numero || 'S/N'}`;
        select.appendChild(option);
      });
    }

    function renderizarAnotacoes() {
      const processoId = document.getElementById('selectProcesso').value;
      const container = document.getElementById('listaAnotacoes');
      
      if (!processoId) {
        container.innerHTML = '<div class="no-data">Selecione um processo para ver as anotações.</div>';
        return;
      }
      
      const anotacoes = carregarAnotacoes().filter(a => a.processoId === processoId);
      
      if (anotacoes.length === 0) {
        container.innerHTML = '<div class="no-data">Nenhuma anotação para este processo.</div>';
        return;
      }
      
      let html = '';
      anotacoes.forEach(a => {
        html += `<div class="note-card">
          <div class="note-meta">${new Date(a.data).toLocaleString('pt-BR')}</div>
          <div class="note-text">${a.texto}</div>
          <button class="btn danger" onclick="deletarAnotacao('${a.id}')" style="margin-top:8px;font-size:12px;padding:4px 8px">
            <span class="material-icons" style="font-size:16px">delete</span> Excluir
          </button>
        </div>`;
      });
      
      container.innerHTML = html;
    }

    document.getElementById('selectProcesso').addEventListener('change', renderizarAnotacoes);

    document.getElementById('btnSalvarAnotacao').addEventListener('click', () => {
      const processoId = document.getElementById('selectProcesso').value;
      const texto = document.getElementById('inputAnotacao').value.trim();
      
      if (!processoId) {
        mostrarAlerta('alertAnotacoes', 'Selecione um processo primeiro.', 'error');
        return;
      }
      
      if (!texto) {
        mostrarAlerta('alertAnotacoes', 'Digite uma anotação.', 'error');
        return;
      }
      
      const anotacoes = carregarAnotacoes();
      anotacoes.push({
        id: Date.now().toString(),
        processoId,
        texto,
        data: new Date().toISOString()
      });
      
      salvarAnotacoes(anotacoes);
      document.getElementById('inputAnotacao').value = '';
      renderizarAnotacoes();
      mostrarAlerta('alertAnotacoes', 'Anotação salva com sucesso!', 'success');
      
      setTimeout(() => {
        document.getElementById('alertAnotacoes').innerHTML = '';
      }, 3000);
    });

    window.deletarAnotacao = function(id) {
      if (!confirm('Deseja realmente excluir esta anotação?')) return;
      
      let anotacoes = carregarAnotacoes();
      anotacoes = anotacoes.filter(a => a.id !== id);
      salvarAnotacoes(anotacoes);
      renderizarAnotacoes();
    };

    // ========== CALCULADORA DE PRAZOS ==========
    document.getElementById('btnCalcularPrazo').addEventListener('click', () => {
      const dataInicial = document.getElementById('dataInicial').value;
      const tipoPrazo = document.getElementById('tipoPrazo').value;
      const quantidade = parseInt(document.getElementById('quantidadeDias').value);
      
      if (!dataInicial || !quantidade) {
        alert('Preencha a data inicial e a quantidade de dias.');
        return;
      }
      
      const data = new Date(dataInicial + 'T00:00:00');
      let diasAdicionados = 0;
      
      if (tipoPrazo === 'corrido') {
        data.setDate(data.getDate() + quantidade);
        diasAdicionados = quantidade;
      } else {
        // Dias úteis (não considera feriados)
        while (diasAdicionados < quantidade) {
          data.setDate(data.getDate() + 1);
          const diaSemana = data.getDay();
          if (diaSemana !== 0 && diaSemana !== 6) {
            diasAdicionados++;
          }
        }
      }
      
      const resultado = document.getElementById('resultadoPrazo');
      const texto = document.getElementById('resultadoTexto');
      
      texto.innerHTML = `
        <strong>Data Final:</strong> ${data.toLocaleDateString('pt-BR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}<br>
        <strong>Prazo:</strong> ${quantidade} ${tipoPrazo === 'corrido' ? 'dias corridos' : 'dias úteis'}
      `;
      
      resultado.style.display = 'block';
    });

    // ========== LIMPAR TODOS OS DADOS ==========
    document.getElementById('btnLimparTodos').addEventListener('click', () => {
      if (!confirm('ATENÇÃO: Isso irá apagar TODOS os processos e anotações. Deseja continuar?')) return;
      if (!confirm('Tem certeza? Esta ação não pode ser desfeita!')) return;
      
      localStorage.removeItem(DB_KEY);
      localStorage.removeItem(NOTES_KEY);
      
      alert('Todos os dados foram removidos com sucesso.');
      renderizarTabela();
      renderizarAnotacoes();
    });

    // ========== UTILITÁRIOS ==========
    function mostrarAlerta(containerId, mensagem, tipo) {
      const container = document.getElementById(containerId);
      container.innerHTML = `<div class="alert ${tipo}">${mensagem}</div>`;
    }

    // Inicializar ao carregar
    renderizarTabela();
  </script>
</body>
</html>
